!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CubismPack=e():t.CubismPack=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=0)}([function(t,e,i){"use strict";var s;i.r(e),(s||(s={})).csmString=class{constructor(t){this.s=t}append(t,e){return this.s+=void 0!==e?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return 0==this.s.length}};const r=(t,e,i)=>{((t,e,i)=>{g.CubismDebug.print(t,"[CSM]"+e,i)})(t,e+"\n",i)},a=t=>{console.assert(t)};let n,o,l,u,h;var g,d,c;n=(t,...e)=>{r(I.LogLevel_Verbose,"[V]"+t,e)},o=(t,...e)=>{r(I.LogLevel_Debug,"[D]"+t,e)},l=(t,...e)=>{r(I.LogLevel_Info,"[I]"+t,e)},u=(t,...e)=>{r(I.LogLevel_Warning,"[W]"+t,e)},h=(t,...e)=>{r(I.LogLevel_Error,"[E]"+t,e)},function(t){t.CubismDebug=class{static print(t,e,i){if(t<v.CubismFramework.getLoggingLevel())return;const s=v.CubismFramework.coreLogFunction;s&&s(e.replace(/\{(\d+)\}/g,(t,e)=>i[e]))}static dumpBytes(t,e,i){for(let s=0;s<i;s++)s%16==0&&s>0?this.print(t,"\n"):s%8==0&&s>0&&this.print(t,"  "),this.print(t,"{0} ",[255&e[s]]);this.print(t,"\n")}constructor(){}}}(g||(g={})),function(t){class e{constructor(t,e){this.first=null==t?null:t,this.second=null==e?null:e}}t.csmPair=e;class i{constructor(t){null!=t?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new e(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t){i=e;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(0==this._keyValues.length?(!e&&t<i.DefaultSize&&(t=i.DefaultSize),this._keyValues.length=t):(!e&&t<2*this._keyValues.length&&(t=2*this._keyValues.length),this._keyValues.length=t))}begin(){return new s(this,0)}end(){return new s(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new s(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)o("{0} ,",this._keyValues[t]),o("\n")}}i.DefaultSize=10,t.csmMap=i;class s{constructor(t,e){this._map=null!=t?t:new i,this._index=null!=e?e:0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){const t=new s(this._map,this._index++);return this._map=t._map,this._index=t._index,this}decrement(){const t=new s(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}t.iterator=s}(d||(d={})),function(t){class e{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(0==this._capacity?e.s_defaultSize:2*this._capacity),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let i=0;i<t;i++)this._ptr[i]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let i=this._size;i<t;i++)this._ptr[i]="function"==typeof e?JSON.parse(JSON.stringify(new e)):e;else for(let i=this._size;i<t;i++)this._ptr[i]=e;else{const e=this._size-t;this._ptr.splice(this._size-e,e)}this._size=t}insert(t,e,i){let s=t._index;const r=e._index,a=i._index,n=a-r;this.prepareCapacity(this._size+n);const o=this._size-s;if(o>0)for(let t=0;t<o;t++)this._ptr.splice(s+t,0,null);for(let t=r;t<a;t++,s++)this._ptr[s]=e._vector._ptr[t];this._size=this._size+n}remove(t){return!(t<0||this._size<=t)&&(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new i(this,e))}prepareCapacity(t){t>this._capacity&&(0==this._capacity?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return 0==this._size?this.end():new i(this,0)}end(){return new i(this,this._size)}getOffset(t){const i=new e;return i._ptr=this.get(t),i._size=this.get(t).length,i._capacity=this.get(t).length,i}}e.s_defaultSize=10,t.csmVector=e;class i{constructor(t,e){this._vector=null!=t?t:null,this._index=null!=e?e:0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){const t=new i(this._vector,this._index++);return this._vector=t._vector,this._index=t._index,this}decrement(){const t=new i(this._vector,this._index--);return this._vector=t._vector,this._index=t._index,this}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}}t.iterator=i}(c||(c={}));var _,m=c.csmVector,p=d.csmMap,y=s.csmString;!function(t){class e{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t){return t}getMap(t){return t}getValueByIndex(t){return e.errorValue.setErrorNotForClientCall("Error: type mismatch")}getValueByString(t){return e.nullValue.setErrorNotForClientCall("Error: type mismatch")}getKeys(){return e.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return n.errorValue}static staticInitializeNotForClientCall(){r.trueValue=new r(!0),r.falseValue=new r(!1),n.errorValue=new n("ERROR",!0),this.nullValue=new o,e.s_dummyKeys=new m}static staticReleaseNotForClientCall(){r.trueValue=null,r.falseValue=null,n.errorValue=null,e.nullValue=null,e.s_dummyKeys=null,r.trueValue=null,r.falseValue=null,n.errorValue=null,e.nullValue=null,e.s_dummyKeys=null}}t.Value=e;class i{constructor(t,e){this._error=null,this._lineCount=0,this._root=null,null!=t&&this.parseBytes(t,e)}static create(t,e){const s=new i;return s.parseBytes(t,e)?s:(i.delete(s),null)}static delete(t){null}getRoot(){return this._root}arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let t=0,s=e.length;t<s;++t)i+="%"+this.pad(e[t].toString(16));return i=decodeURIComponent(i),i}pad(t){return t.length<2?"0"+t:t}parseBytes(t,e){const i=new Array(1),s=this.arrayBufferToString(t);if(this._root=this.parseValue(s,e,0,i),this._error){let t="\0";return t="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new a(t),l("{0}",this._root.getRawString()),!1}return null!=this._root||(this._root=new n(new y(this._error),!1),!1)}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,n){if(this._error)return null;let l,u=null,h=i;for(;h<e;h++){switch(t[h]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const e=new Array(1);return l=E(t.slice(h),e),n[0]=t.indexOf(e[0]),new s(l)}case'"':return new a(this.parseString(t,e,h+1,n));case"[":return u=this.parseArray(t,e,h+1,n),u;case"{":return u=this.parseObject(t,e,h+1,n),u;case"n":return h+3<e?(u=new o,n[0]=h+4):this._error="parse null",u;case"t":return h+3<e?(u=r.trueValue,n[0]=h+4):this._error="parse true",u;case"f":return h+4<e?(u=r.falseValue,n[0]=h+5):this._error="illegal ',' position",u;case",":return this._error="illegal ',' position",null;case"]":return n[0]=h,null;case"\n":this._lineCount++}}return this._error="illegal end of value",null}parseString(t,e,i,s){if(this._error)return null;let r,a,n=i;const o=new y("");let l=i;for(;n<e;n++)switch(r=t[n],r){case'"':return s[0]=n+1,o.append(t.slice(l),n-l),o.s;case"//":if(n++,n-1>l&&o.append(t.slice(l),n-l),l=n+1,n<e)switch(a=t[n],a){case"\\":o.expansion(1,"\\");break;case'"':o.expansion(1,'"');break;case"/":o.expansion(1,"/");break;case"b":o.expansion(1,"\b");break;case"f":o.expansion(1,"\f");break;case"n":o.expansion(1,"\n");break;case"r":o.expansion(1,"\r");break;case"t":o.expansion(1,"\t");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,s){if(this._error)return null;const r=new h;let a="",n=i,o="";const l=Array(1);let u=!1;for(;n<e;n++){t:for(;n<e;n++)switch(o=t[n],o){case'"':if(a=this.parseString(t,e,n+1,l),this._error)return null;n=l[0],u=!0;break t;case"}":return s[0]=n+1,r;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!u)return this._error="key not found",null;u=!1;t:for(;n<e;n++)switch(o=t[n],o){case":":u=!0,n++;break t;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!u)return this._error="':' not found",null;const i=this.parseValue(t,e,n,l);if(this._error)return null;n=l[0],r.put(a,i);t:for(;n<e;n++)switch(o=t[n],o){case",":break t;case"}":return s[0]=n+1,r;case"\n":this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,s){if(this._error)return null;let r,a=new u,n=i;const o=new Array(1);for(;n<e;n++){const i=this.parseValue(t,e,n,o);if(this._error)return null;n=o[0],i&&a.add(i);t:for(;n<e;n++)switch(r=t[n],r){case",":break t;case"]":return s[0]=n+1,a;case"\n":++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}t.CubismJson=i;class s extends e{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return"number"==typeof t&&(!Math.round(t)&&t==this._value)}}t.JsonFloat=s;class r extends e{constructor(t){super(),this._boolValue=t}isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return"boolean"==typeof t&&t==this._boolValue}isStatic(){return!0}}t.JsonBoolean=r;class a extends e{constructor(t){super(),"string"==typeof t&&(this._stringBuffer=t),t instanceof y&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return"string"==typeof t?this._stringBuffer==t:t instanceof y&&this._stringBuffer==t.s}}t.JsonString=a;class n extends a{constructor(t,e){super(t),this._isStatic=e}isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}isError(){return!0}}t.JsonError=n;class o extends e{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}constructor(){super(),this._stringBuffer="NullValue"}}t.JsonNullvalue=o;class u extends e{constructor(){super(),this._array=new m}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return e.errorValue.setErrorNotForClientCall("Error: index out of bounds");const i=this._array.at(t);return null==i?e.nullValue:i}getValueByString(t){return e.errorValue.setErrorNotForClientCall("Error: type mismatch")}getString(t,e){const i=e+"[\n";for(let t=this._array.begin();t.notEqual(this._array.end());t.increment()){const i=t.ptr();this._stringBuffer+=e+""+i.getString(e+" ")+"\n"}return this._stringBuffer=i+e+"]\n",this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}t.JsonArray=u;class h extends e{constructor(){super(),this._map=new p}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof y){const i=this._map.getValue(t.s);return null==i?e.nullValue:i}for(let i=this._map.begin();i.notEqual(this._map.end());i.preIncrement())if(i.ptr().first==t)return null==i.ptr().second?e.nullValue:i.ptr().second;return e.nullValue}getValueByIndex(t){return e.errorValue.setErrorNotForClientCall("Error: type mismatch")}getString(t,e){this._stringBuffer=e+"{\n";const i=this._map.begin();for(;i.notEqual(this._map.end());){const t=i.ptr().first,s=i.ptr().second;this._stringBuffer+=e+" "+t+" : "+s.getString(e+"   ")+" \n",i.preIncrement()}return this._stringBuffer+=e+"}\n",this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new m;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}t.JsonMap=h}(_||(_={}));var f,S=s.csmString;!function(t){class e{constructor(t){this._id="string"!=typeof t?t:new S(t)}getString(){return this._id}isEqual(t){return"string"==typeof t?this._id.isEqual(t):t instanceof S?this._id.isEqual(t.s):t instanceof e&&this._id.isEqual(t._id.s)}isNotEqual(t){return"string"==typeof t?!this._id.isEqual(t):t instanceof S?!this._id.isEqual(t.s):t instanceof e&&!this._id.isEqual(t._id.s)}}t.CubismId=e}(f||(f={}));var x,C,B=f.CubismId,M=c.csmVector;!function(t){t.CubismIdManager=class{constructor(){this._ids=new M}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;return"string"!=typeof t?this.registerId(t.s):null!=(e=this.findId(t))?e:(e=new B(t),this._ids.pushBack(e),e)}getId(t){return this.registerId(t)}isExist(t){return"string"==typeof t?null!=this.findId(t):this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}}(x||(x={})),function(t){class e{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const s=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let i=0;i<4;++i)for(let r=0;r<4;++r)for(let a=0;a<4;++a)s[r+4*i]+=t[a+4*i]*e[r+4*a];for(let t=0;t<16;++t)i[t]=s[t]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,i){const s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,i,0,1]);e.multiply(s,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,i){const s=new Float32Array([t,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]);e.multiply(s,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){e.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new e;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}t.CubismMatrix44=e}(C||(C={}));var b,P=C.CubismMatrix44;!function(t){let e;t.CubismRenderer=class{constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisortopy=0,this._model=null,this._modelColor=new i,this._mvpMatrix4x4=new P,this._mvpMatrix4x4.loadIdentity()}static create(){return null}static delete(t){null}initialize(t){this._model=t}drawModel(){null!=this.getModel()&&this.doDrawModel()}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,s){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=s}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisortopy=t}getAnisotropy(){return this._anisortopy}getModel(){return this._model}},function(t){t[t.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",t[t.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",t[t.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative"}(e=t.CubismBlendMode||(t.CubismBlendMode={}));class i{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}}t.CubismTextureColor=i}(b||(b={}));var v,I,V=_.Value,w=x.CubismIdManager,T=b.CubismRenderer;function E(t,e){let i=0;for(let e=1;;e++){const s=t.slice(e-1,e);if("e"==s||"-"==s||"E"==s)continue;const r=t.substring(0,e),a=Number(r);if(isNaN(a))break;i=e}let s=parseFloat(t);return isNaN(s)&&(s=NaN),e[0]=t.slice(i),s}!function(t){let e,i=!1,s=!1,r=null,n=null;!function(t){t.vertexOffset=0,t.vertexStep=2}(e=t.Constant||(t.Constant={})),t.csmDelete=function(t){t&&(t=void 0)};t.CubismFramework=class{static startUp(t=null){if(i)return l("CubismFramework.startUp() is already done."),i;if(r=t,null!=r&&Live2DCubismCore.Logging.csmSetLogFunction(r.logFunction),i=!0,i){const t=Live2DCubismCore.Version.csmGetVersion(),e=(16711680&t)>>16,i=65535&t,s=t;l("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+((4278190080&t)>>24)).slice(-2),("00"+e).slice(-2),("0000"+i).slice(-4),s)}return l("CubismFramework.startUp() is complete."),i}static cleanUp(){i=!1,s=!1,r=null,n=null}static initialize(){a(i),i?s?u("CubismFramework.initialize() skipped, already initialized."):(V.staticInitializeNotForClientCall(),n=new w,s=!0,l("CubismFramework.initialize() is complete.")):u("CubismFramework is not started.")}static dispose(){a(i),i?s?(V.staticReleaseNotForClientCall(),n.release(),n=null,T.staticRelease(),s=!1,l("CubismFramework.dispose() is complete.")):u("CubismFramework.dispose() skipped, not initialized."):u("CubismFramework is not started.")}static isStarted(){return i}static isInitialized(){return s}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return null!=r?r.loggingLevel:I.LogLevel_Off}static getIdManager(){return n}constructor(){}}}(v||(v={}));class F{}!function(t){t[t.LogLevel_Verbose=0]="LogLevel_Verbose",t[t.LogLevel_Debug=1]="LogLevel_Debug",t[t.LogLevel_Info=2]="LogLevel_Info",t[t.LogLevel_Warning=3]="LogLevel_Warning",t[t.LogLevel_Error=4]="LogLevel_Error",t[t.LogLevel_Off=5]="LogLevel_Off"}(I||(I={}));var L,R=C.CubismMatrix44;!function(t){t.CubismViewMatrix=class extends R{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);R.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){const s=this.getMaxScale(),r=this.getMinScale(),a=i*this._tr[0];a<r?this._tr[0]>0&&(i=r/this._tr[0]):a>s&&this._tr[0]>0&&(i=s/this._tr[0]);const n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),o=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);R.multiply(l,this._tr,this._tr),R.multiply(o,this._tr,this._tr),R.multiply(n,this._tr,this._tr)}setScreenRect(t,e,i,s){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=s}setMaxScreenRect(t,e,i,s){this._maxLeft=t,this._maxRight=e,this._maxTop=s,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}}(L||(L={}));class D{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,s){return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,s=Math.abs(t),r=Math.abs(e);return i*(s<r?s:r)}}var A,k;!function(t){t.Head="head",t.Face="face",t.Oppai="oppai",t.Body="body"}(A||(A={}));class N extends Event{constructor(t){super("cleatouch",t)}}class O extends Event{constructor(t){super("cleadragend",t)}}!function(t){class e{constructor(t,e){this.x=t,this.y=e,this.x=null==t?0:t,this.y=null==e?0:e}add(t){const i=new e(0,0);return i.x=this.x+t.x,i.y=this.y+t.y,i}substract(t){const i=new e(0,0);return i.x=this.x-t.x,i.y=this.y-t.y,i}multiply(t){const i=new e(0,0);return i.x=this.x*t.x,i.y=this.y*t.y,i}multiplyByScaler(t){return this.multiply(new e(t,t))}division(t){const i=new e(0,0);return i.x=this.x/t.x,i.y=this.y/t.y,i}divisionByScalar(t){return this.division(new e(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}t.CubismVector2=e}(k||(k={}));var U,z=k.CubismVector2;!function(t){t.CubismMath=class{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return 180*t/Math.PI}static directionToRadian(t,e){let i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let s=this.radianToDegrees(i);return e.x-t.x>0&&(s=-s),s}static radianToDirection(t){const e=new z;return e.x=this.sin(t),e.y=this.cos(t),e}constructor(){}}}(U||(U={}));var X,j=c.csmVector,Y=U.CubismMath;!function(t){t.ACubismMotion=class{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new j}static delete(t){t.release(),t=void 0,t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const t=this.getDuration();e.getEndTime()<0&&e.setEndTime(t<=0?-1:e.getStartTime()+t)}let s=this._weight;s=s*(0==this._fadeInSeconds?1:Y.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||e.getEndTime()<0?1:Y.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds)),e.setState(i,s),a(0<=s&&s<=1),this.doUpdateParameters(t,i,s,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}}}(X||(X={}));var q,H=X.ACubismMotion;!function(t){t.CubismMotionQueueEntry=class{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this}release(){this._autoDelete&&this._motion&&H.delete(this._motion)}startFadeout(t,e){const i=e+t;(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventTime(){return this._lastEventCheckSeconds}setLastCheckEventTime(t){this._lastEventCheckSeconds=t}}}(q||(q={}));var G,W=c.csmVector,J=q.CubismMotionQueueEntry;!function(t){t.CubismMotionQueueManager=class{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new W}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,void 0),this._motions.set(t,null));this._motions=null}startMotion(e,i,s){if(null==e)return t.InvalidMotionQueueEntryHandleValue;let r=null;for(let t=0;t<this._motions.getSize();++t)r=this._motions.at(t),null!=r&&r.startFadeout(r._motion.getFadeOutTime(),s);return r=new J,r._autoDelete=i,r._motion=e,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(null==e){t=this._motions.erase(t);continue}if(null!=e._motion){if(!e.isFinished())return!1;t.preIncrement()}else e.release(),e=void 0,e=null,t=this._motions.erase(t)}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(null!=i&&(i._motionQueueEntryHandle==t&&!i.isFinished()))return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();null!=e?(e.release(),e=void 0,e=null,t=this._motions.erase(t)):t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(null!=i&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let s=this._motions.begin();s.notEqual(this._motions.end());){let r=s.ptr();if(null==r){s=this._motions.erase(s);continue}const a=r._motion;if(null==a){r.release(),r=void 0,r=null,s=this._motions.erase(s);continue}a.updateParameters(t,r,e),i=!0;const n=a.getFiredEvent(r.getLastCheckEventTime()-r.getStartTime(),e-r.getStartTime());for(let t=0;t<n.getSize();++t)this._eventCallBack(this,n.at(t),this._eventCustomData);r.setLastCheckEventTime(e),r.isFinished()?(r.release(),r=void 0,r=null,s=this._motions.erase(s)):s.preIncrement()}return i}},t.InvalidMotionQueueEntryHandleValue=-1}(G||(G={}));var $,K=G.CubismMotionQueueManager;!function(t){t.CubismMotionManager=class extends K{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e,this._userTimeSeconds)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return!(t<=this._reservePriority||t<=this._currentPriority)&&(this._reservePriority=t,!0)}}}($||($={}));var Z,Q=U.CubismMath;!function(t){t.CubismTargetPoint=class{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;if(0==this._lastTimeSeconds)return void(this._lastTimeSeconds=this._userTimeSeconds);const e=30*(this._userTimeSeconds-this._lastTimeSeconds);this._lastTimeSeconds=this._userTimeSeconds;const i=e*(4/30)/4.5,s=this._faceTargetX-this._faceX,r=this._faceTargetY-this._faceY;if(Q.abs(s)<=.01&&Q.abs(r)<=.01)return;const a=Q.sqrt(s*s+r*r),n=4/30*r/a;let o=4/30*s/a-this._faceVX,l=n-this._faceVY;const u=Q.sqrt(o*o+l*l);(u<-i||u>i)&&(o*=i/u,l*=i/u),this._faceVX+=o,this._faceVY+=l;{const t=.5*(Q.sqrt(i*i+16*i*a-8*i*a)-i),e=Q.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);e>t&&(this._faceVX*=t/e,this._faceVY*=t/e)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}}(Z||(Z={}));var tt,et=C.CubismMatrix44;!function(t){t.CubismModelMatrix=class extends et{constructor(t,e){super(),this._width=void 0!==t?t:0,this._height=void 0!==e?e:0,this.setHeight(1)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"width"==t?this.setWidth(i):"height"==t&&this.setHeight(i)}for(const e=t.begin();e.notEqual(t.end());e.preIncrement()){const t=e.ptr().first,i=e.ptr().second;"x"==t?this.setX(i):"y"==t?this.setY(i):"center_x"==t?this.centerX(i):"center_y"==t?this.centerY(i):"top"==t?this.top(i):"bottom"==t?this.bottom(i):"left"==t?this.left(i):"right"==t&&this.right(i)}}}}(tt||(tt={}));var it,st=v.CubismFramework,rt=b.CubismBlendMode,at=c.csmVector,nt=d.csmMap;!function(t){t.CubismModel=class{constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new at,this._parameterIds=new at,this._drawableIds=new at,this._partIds=new at,this._notExistPartId=new nt,this._notExistParameterId=new nt,this._notExistParameterValues=new nt,this._notExistPartOpacities=new nt}update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.setValue(t,e):(a(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e)}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(a(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(a(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){this._notExistParameterValues.isExist(t)?this._notExistParameterValues.setValue(t,1==i?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i):(a(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=1==i?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i)}setParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.setParameterValueByIndex(s,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.addParameterValueByIndex(s,e,i)}multiplyParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.multiplyParameterValueByIndex(s,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return st.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableCulling(t){const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?rt.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?rt.CubismBlendMode_Multiplicative:rt.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let e=0;e<t;++e)this._parameterValues[e]=this._savedParameters.at(e)}initialize(){a(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(let i=0;i<e;++i)this._parameterIds.pushBack(st.getIdManager().getId(t[i]))}{const t=this._model.parts.ids,e=this._model.parts.count;this._partIds.prepareCapacity(e);for(let i=0;i<e;++i)this._partIds.pushBack(st.getIdManager().getId(t[i]))}{const t=this._model.drawables.ids,e=this._model.drawables.count;this._drawableIds.prepareCapacity(e);for(let i=0;i<e;++i)this._drawableIds.pushBack(st.getIdManager().getId(t[i]))}}release(){this._model.release(),this._model=null}}}(it||(it={}));var ot,lt=it.CubismModel;!function(t){class e{constructor(t){this._moc=t,this._modelCount=0}static create(t){let i=null;const s=Live2DCubismCore.Moc.fromArrayBuffer(t);return s&&(i=new e(s)),i}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new lt(e),t.initialize(),++this._modelCount),t}deleteModel(t){null!=t&&(t.release(),t=null,--this._modelCount)}release(){a(0==this._modelCount),this._moc._release(),this._moc=null}}t.CubismMoc=e}(ot||(ot={}));var ut,ht=s.csmString,gt=v.CubismFramework,dt=_.CubismJson;!function(t){const e="Meta";t.CubismMotionJson=class{constructor(t,e){this._json=dt.create(t,e)}release(){dt.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(e).getValueByString("Duration").toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(e).getValueByString("Loop").toBoolean()}getMotionCurveCount(){return this._json.getRoot().getValueByString(e).getValueByString("CurveCount").toInt()}getMotionFps(){return this._json.getRoot().getValueByString(e).getValueByString("Fps").toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(e).getValueByString("TotalSegmentCount").toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(e).getValueByString("TotalPointCount").toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(e).getValueByString("FadeInTime").isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(e).getValueByString("FadeOutTime").isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(e).getValueByString("FadeInTime").toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(e).getValueByString("FadeOutTime").toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Target").getRawString()}getMotionCurveId(t){return gt.getIdManager().getId(this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Id").getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeInTime").isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeOutTime").isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeInTime").toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeOutTime").toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Segments").getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Segments").getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(e).getValueByString("UserDataCount").toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(e).getValueByString("TotalUserDataSize").toInt()}getEventTime(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Time").toInt()}getEventValue(t){return new ht(this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Value").getRawString())}}}(ut||(ut={}));var ct,_t=c.csmVector;!function(t){let e,i;!function(t){t[t.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",t[t.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",t[t.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity"}(e=t.CubismMotionCurveTarget||(t.CubismMotionCurveTarget={})),function(t){t[t.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",t[t.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",t[t.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",t[t.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped"}(i=t.CubismMotionSegmentType||(t.CubismMotionSegmentType={}));t.CubismMotionPoint=class{constructor(){this.time=0,this.value=0}};t.CubismMotionSegment=class{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}};t.CubismMotionCurve=class{constructor(){this.type=e.CubismMotionCurveTarget_Model,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}};t.CubismMotionEvent=class{constructor(){this.fireTime=0}};t.CubismMotionData=class{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new _t,this.segments=new _t,this.points=new _t,this.events=new _t}}}(ct||(ct={}));var mt,pt=s.csmString,yt=ct.CubismMotionData,ft=ct.CubismMotionSegment,St=ct.CubismMotionPoint,xt=ct.CubismMotionEvent,Ct=ct.CubismMotionSegmentType,Bt=ct.CubismMotionCurve,Mt=ct.CubismMotionCurveTarget,bt=U.CubismMath,Pt=v.CubismFramework,vt=X.ACubismMotion,It=ut.CubismMotionJson;!function(t){function e(t,e,i){const s=new St;return s.time=t.time+(e.time-t.time)*i,s.value=t.value+(e.value-t.value)*i,s}function i(t,e){let i=(e-t[0].time)/(t[1].time-t[0].time);return i<0&&(i=0),t[0].value+(t[1].value-t[0].value)*i}function s(t,i){let s=(i-t[0].time)/(t[3].time-t[0].time);s<0&&(s=0);const r=e(t[0],t[1],s),a=e(t[1],t[2],s),n=e(t[2],t[3],s),o=e(r,a,s),l=e(a,n,s);return e(o,l,s).value}function r(t,e){return t[0].value}function n(t,e){return t[1].value}function l(t,e,i){const s=t.curves.at(e);let r=-1;const a=s.baseSegmentIndex+s.segmentCount;let n=0;for(let e=s.baseSegmentIndex;e<a;++e)if(n=t.segments.at(e).basePointIndex+(t.segments.at(e).segmentType==Ct.CubismMotionSegmentType_Bezier?3:1),t.points.at(n).time>i){r=e;break}if(-1==r)return t.points.at(n).value;const o=t.segments.at(r);return o.evaluate(t.points.get(o.basePointIndex),i)}class u extends vt{constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null}static create(t,e,i){const s=new u;return s.parse(t,e),s._sourceFrameRate=s._motionData.fps,s._loopDurationSeconds=s._motionData.duration,s._onFinishedMotion=i,s}doUpdateParameters(t,e,i,s){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink=Pt.getIdManager().getId("EyeBlink")),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync=Pt.getIdManager().getId("LipSync"));let r=e-s.getStartTime();r<0&&(r=0);let a=Number.MAX_VALUE,n=Number.MAX_VALUE;let u=0,h=0;this._eyeBlinkParameterIds.getSize()>64&&o("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>64&&o("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const g=this._fadeInSeconds<=0?1:bt.getEasingSine((e-s.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||s.getEndTime()<0?1:bt.getEasingSine((s.getEndTime()-e)/this._fadeOutSeconds);let c,_,m,p=r;if(this._isLoop)for(;p>this._motionData.duration;)p-=this._motionData.duration;const y=this._motionData.curves;for(_=0;_<this._motionData.curveCount&&y.at(_).type==Mt.CubismMotionCurveTarget_Model;++_)c=l(this._motionData,_,p),y.at(_).id==this._modelCurveIdEyeBlink?n=c:y.at(_).id==this._modelCurveIdLipSync&&(a=c);for(;_<this._motionData.curveCount&&y.at(_).type==Mt.CubismMotionCurveTarget_Parameter;++_){if(m=t.getParameterIndex(y.at(_).id),-1==m)continue;const r=t.getParameterValueByIndex(m);if(c=l(this._motionData,_,p),n!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.getSize()&&t<64;++t)if(this._eyeBlinkParameterIds.at(t)==y.at(_).id){c*=n,h|=1<<t;break}if(a!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.getSize()&&t<64;++t)if(this._lipSyncParameterIds.at(t)==y.at(_).id){c+=a,u|=1<<t;break}let o;if(y.at(_).fadeInTime<0&&y.at(_).fadeOutTime<0)o=r+(c-r)*i;else{let t,i;t=y.at(_).fadeInTime<0?g:0==y.at(_).fadeInTime?1:bt.getEasingSine((e-s.getFadeInStartTime())/y.at(_).fadeInTime),i=y.at(_).fadeOutTime<0?d:0==y.at(_).fadeOutTime||s.getEndTime()<0?1:bt.getEasingSine((s.getEndTime()-e)/y.at(_).fadeOutTime),o=r+(c-r)*(this._weight*t*i)}t.setParameterValueByIndex(m,o,1)}if(n!=Number.MAX_VALUE)for(let e=0;e<this._eyeBlinkParameterIds.getSize()&&e<64;++e){const s=t.getParameterValueById(this._eyeBlinkParameterIds.at(e));if(h>>e&1)continue;const r=s+(n-s)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(e),r)}if(a!=Number.MAX_VALUE)for(let e=0;e<this._lipSyncParameterIds.getSize()&&e<64;++e){const s=t.getParameterValueById(this._lipSyncParameterIds.at(e));if(u>>e&1)continue;const r=s+(a-s)*i;t.setParameterValueById(this._lipSyncParameterIds.at(e),r)}for(;_<this._motionData.curveCount&&y.at(_).type==Mt.CubismMotionCurveTarget_PartOpacity;++_)m=t.getPartIndex(y.at(_).id),-1!=m&&(c=l(this._motionData,_,p),t.setPartOpacityByIndex(m,c));r>=this._motionData.duration&&(this._isLoop?(s.setStartTime(e),this._isLoopFadeIn&&s.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id)return void(i.at(s).fadeInTime=e)}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id)return void(i.at(s).fadeOutTime=e)}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new yt;let o=new It(t,e);this._motionData.duration=o.getMotionDuration(),this._motionData.loop=o.isMotionLoop(),this._motionData.curveCount=o.getMotionCurveCount(),this._motionData.fps=o.getMotionFps(),this._motionData.eventCount=o.getEventCount(),o.isExistMotionFadeInTime()?this._fadeInSeconds=o.getMotionFadeInTime()<0?1:o.getMotionFadeInTime():this._fadeInSeconds=1,o.isExistMotionFadeOutTime()?this._fadeOutSeconds=o.getMotionFadeOutTime()<0?1:o.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,Bt,!0),this._motionData.segments.updateSize(o.getMotionTotalSegmentCount(),ft,!0),this._motionData.points.updateSize(o.getMotionTotalPointCount(),St,!0),this._motionData.events.updateSize(this._motionData.eventCount,xt,!0);let l=0,u=0;for(let t=0;t<this._motionData.curveCount;++t){"Model"==o.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=Mt.CubismMotionCurveTarget_Model:"Parameter"==o.getMotionCurveTarget(t)?this._motionData.curves.at(t).type=Mt.CubismMotionCurveTarget_Parameter:"PartOpacity"==o.getMotionCurveTarget(t)&&(this._motionData.curves.at(t).type=Mt.CubismMotionCurveTarget_PartOpacity),this._motionData.curves.at(t).id=o.getMotionCurveId(t),this._motionData.curves.at(t).baseSegmentIndex=u,this._motionData.curves.at(t).fadeInTime=o.isExistMotionCurveFadeInTime(t)?o.getMotionCurveFadeInTime(t):-1,this._motionData.curves.at(t).fadeOutTime=o.isExistMotionCurveFadeOutTime(t)?o.getMotionCurveFadeOutTime(t):-1;for(let e=0;e<o.getMotionCurveSegmentCount(t);){switch(0==e?(this._motionData.segments.at(u).basePointIndex=l,this._motionData.points.at(l).time=o.getMotionCurveSegment(t,e),this._motionData.points.at(l).value=o.getMotionCurveSegment(t,e+1),l+=1,e+=2):this._motionData.segments.at(u).basePointIndex=l-1,o.getMotionCurveSegment(t,e)){case Ct.CubismMotionSegmentType_Linear:this._motionData.segments.at(u).segmentType=Ct.CubismMotionSegmentType_Linear,this._motionData.segments.at(u).evaluate=i,this._motionData.points.at(l).time=o.getMotionCurveSegment(t,e+1),this._motionData.points.at(l).value=o.getMotionCurveSegment(t,e+2),l+=1,e+=3;break;case Ct.CubismMotionSegmentType_Bezier:this._motionData.segments.at(u).segmentType=Ct.CubismMotionSegmentType_Bezier,this._motionData.segments.at(u).evaluate=s,this._motionData.points.at(l).time=o.getMotionCurveSegment(t,e+1),this._motionData.points.at(l).value=o.getMotionCurveSegment(t,e+2),this._motionData.points.at(l+1).time=o.getMotionCurveSegment(t,e+3),this._motionData.points.at(l+1).value=o.getMotionCurveSegment(t,e+4),this._motionData.points.at(l+2).time=o.getMotionCurveSegment(t,e+5),this._motionData.points.at(l+2).value=o.getMotionCurveSegment(t,e+6),l+=3,e+=7;break;case Ct.CubismMotionSegmentType_Stepped:this._motionData.segments.at(u).segmentType=Ct.CubismMotionSegmentType_Stepped,this._motionData.segments.at(u).evaluate=r,this._motionData.points.at(l).time=o.getMotionCurveSegment(t,e+1),this._motionData.points.at(l).value=o.getMotionCurveSegment(t,e+2),l+=1,e+=3;break;case Ct.CubismMotionSegmentType_InverseStepped:this._motionData.segments.at(u).segmentType=Ct.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(u).evaluate=n,this._motionData.points.at(l).time=o.getMotionCurveSegment(t,e+1),this._motionData.points.at(l).value=o.getMotionCurveSegment(t,e+2),l+=1,e+=3;break;default:a(0)}++this._motionData.curves.at(t).segmentCount,++u}}for(let t=0;t<o.getEventCount();++t)this._motionData.events.at(t).fireTime=o.getEventTime(t),this._motionData.events.at(t).value=o.getEventValue(t);o.release(),o=void 0,o=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new pt(this._motionData.events.at(i).value.s));return this._firedEventValues}}t.CubismMotion=u}(mt||(mt={}));var Vt,wt=c.csmVector,Tt=v.CubismFramework,Et=_.CubismJson,Ft=X.ACubismMotion;!function(t){class e extends Ft{constructor(){super(),this._parameters=new wt}static create(t,r){const a=new e,n=Et.create(t,r),o=n.getRoot();a.setFadeInTime(o.getValueByString("FadeInTime").toFloat(1)),a.setFadeOutTime(o.getValueByString("FadeOutTime").toFloat(1));const l=o.getValueByString("Parameters").getSize();a._parameters.prepareCapacity(l);for(let t=0;t<l;++t){const e=o.getValueByString("Parameters").getValueByIndex(t),r=Tt.getIdManager().getId(e.getValueByString("Id").getRawString()),n=e.getValueByString("Value").toFloat();let l;l=e.getValueByString("Blend").isNull()||"Add"==e.getValueByString("Blend").getString()?i.ExpressionBlendType_Add:"Multiply"==e.getValueByString("Blend").getString()?i.ExpressionBlendType_Multiply:"Overwrite"==e.getValueByString("Blend").getString()?i.ExpressionBlendType_Overwrite:i.ExpressionBlendType_Add;const u=new s;u.parameterId=r,u.blendType=l,u.value=n,a._parameters.pushBack(u)}return Et.delete(n),a}doUpdateParameters(t,e,s,r){for(let e=0;e<this._parameters.getSize();++e){const r=this._parameters.at(e);switch(r.blendType){case i.ExpressionBlendType_Add:t.addParameterValueById(r.parameterId,r.value,s);break;case i.ExpressionBlendType_Multiply:t.multiplyParameterValueById(r.parameterId,r.value,s);break;case i.ExpressionBlendType_Overwrite:t.setParameterValueById(r.parameterId,r.value,s)}}}}let i;t.CubismExpressionMotion=e,function(t){t[t.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",t[t.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",t[t.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite"}(i=t.ExpressionBlendType||(t.ExpressionBlendType={}));class s{}t.ExpressionParameter=s}(Vt||(Vt={}));var Lt,Rt=c.csmVector,Dt=v.CubismFramework,At=_.CubismJson;!function(t){class e{constructor(){this._fadeTimeSeconds=.5,this._lastModel=null,this._partGroups=new Rt,this._partGroupCounts=new Rt}static create(t,s){const r=new e,a=At.create(t,s),n=a.getRoot();n.getValueByString("FadeInTime").isNull()||(r._fadeTimeSeconds=n.getValueByString("FadeInTime").toFloat(.5),r._fadeTimeSeconds<=0&&(r._fadeTimeSeconds=.5));const o=n.getValueByString("Groups"),l=o.getSize();for(let t=0;t<l;++t){const e=o.getValueByIndex(t),s=e.getSize();let a=0;for(let t=0;t<s;++t){const s=e.getValueByIndex(t),n=new i,o=Dt.getIdManager().getId(s.getValueByString("Id").getRawString());if(n.partId=o,!s.getValueByString("Link").isNull()){const t=s.getValueByString("Link"),e=t.getSize();for(let s=0;s<e;++s){const e=new i,r=Dt.getIdManager().getId(t.getValueByIndex(s).getString());e.partId=r,n.link.pushBack(e)}}r._partGroups.pushBack(n.clone()),++a}r._partGroupCounts.pushBack(a)}return At.delete(a),r}static delete(t){null!=t&&(t=null)}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let s=0;s<this._partGroupCounts.getSize();s++){const r=this._partGroupCounts.at(s);this.doFade(t,e,i,r),i+=r}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const s=this._partGroupCounts.at(i);for(let i=e;i<e+s;++i){this._partGroups.at(i).initialize(t);const s=this._partGroups.at(i).partIndex,r=this._partGroups.at(i).parameterIndex;if(!(s<0)){t.setPartOpacityByIndex(s,i==e?1:0),t.setParameterValueByIndex(r,i==e?1:0);for(let e=0;e<this._partGroups.at(i).link.getSize();++e)this._partGroups.at(i).link.at(e).initialize(t)}}e+=s}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(0==i.link.getSize())continue;const s=this._partGroups.at(e).partIndex,r=t.getPartOpacityByIndex(s);for(let e=0;e<i.link.getSize();++e){const s=i.link.at(e).partIndex;s<0||t.setPartOpacityByIndex(s,r)}}}doFade(t,e,i,s){let r=-1,a=1;for(let n=i;n<i+s;++n){const i=this._partGroups.at(n).partIndex,s=this._partGroups.at(n).parameterIndex;if(t.getParameterValueByIndex(s)>.001){if(r>=0)break;r=n,a=t.getPartOpacityByIndex(i),a+=e/this._fadeTimeSeconds,a>1&&(a=1)}}r<0&&(r=0,a=1);for(let e=i;e<i+s;++e){const i=this._partGroups.at(e).partIndex;if(r==e)t.setPartOpacityByIndex(i,a);else{let e,s=t.getPartOpacityByIndex(i);e=a<.5?-.5*a/.5+1:.5*(1-a)/.5,(1-e)*(1-a)>.15&&(e=1-.15/(1-a)),s>e&&(s=e),t.setPartOpacityByIndex(i,s)}}}}t.CubismPose=e;class i{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new Rt,null!=t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new i;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new Rt;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}t.PartData=i}(Lt||(Lt={}));var kt,Nt=v.CubismFramework,Ot=_.CubismJson;!function(t){t.CubismModelUserDataJson=class{constructor(t,e){this._json=Ot.create(t,e)}release(){Ot.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString("Meta").getValueByString("UserDataCount").toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalUserDataSize").toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Target").getRawString()}getUserDataId(t){return Nt.getIdManager().getId(this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Id").getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Value").getRawString()}}}(kt||(kt={}));var Ut,zt=v.CubismFramework,Xt=c.csmVector,jt=s.csmString,Yt=kt.CubismModelUserDataJson;!function(t){class e{}t.CubismModelUserDataNode=e;class i{constructor(){this._userDataNodes=new Xt,this._artMeshUserDataNode=new Xt}static create(t,e){const s=new i;return s.parseUserData(t,e),s}static delete(t){null!=t&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,i){let s=new Yt(t,i);const r=zt.getIdManager().getId("ArtMesh"),a=s.getUserDataCount();for(let t=0;t<a;t++){const i=new e;i.targetId=s.getUserDataId(t),i.targetType=zt.getIdManager().getId(s.getUserDataTargetType(t)),i.value=new jt(s.getUserDataValue(t)),this._userDataNodes.pushBack(i),i.targetType==r&&this._artMeshUserDataNode.pushBack(i)}s.release(),s=void 0}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}t.CubismModelUserData=i}(Ut||(Ut={}));var qt,Ht=c.csmVector,Gt=k.CubismVector2;!function(t){let e,i;!function(t){t[t.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter"}(e=t.CubismPhysicsTargetType||(t.CubismPhysicsTargetType={})),function(t){t[t.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",t[t.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",t[t.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle"}(i=t.CubismPhysicsSource||(t.CubismPhysicsSource={}));t.PhysicsJsonEffectiveForces=class{constructor(){this.gravity=new Gt(0,0),this.wind=new Gt(0,0)}};class s{}t.CubismPhysicsParameter=s;class r{}t.CubismPhysicsNormalization=r;t.CubismPhysicsParticle=class{constructor(){this.initialPosition=new Gt(0,0),this.position=new Gt(0,0),this.lastPosition=new Gt(0,0),this.lastGravity=new Gt(0,0),this.force=new Gt(0,0),this.velocity=new Gt(0,0)}};t.CubismPhysicsSubRig=class{constructor(){this.normalizationPosition=new r,this.normalizationAngle=new r}};t.CubismPhysicsInput=class{constructor(){this.source=new s}};t.CubismPhysicsOutput=class{constructor(){this.destination=new s,this.translationScale=new Gt(0,0)}};t.CubismPhysicsRig=class{constructor(){this.settings=new Ht,this.inputs=new Ht,this.outputs=new Ht,this.particles=new Ht,this.gravity=new Gt(0,0),this.wind=new Gt(0,0)}}}(qt||(qt={}));var Wt,Jt=v.CubismFramework,$t=k.CubismVector2,Kt=_.CubismJson;!function(t){const e="Meta",i="PhysicsSettings";t.CubismPhysicsJson=class{constructor(t,e){this._json=Kt.create(t,e)}release(){Kt.delete(this._json)}getGravity(){const t=new $t(0,0);return t.x=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Gravity").getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Gravity").getValueByString("Y").toFloat(),t}getWind(){const t=new $t(0,0);return t.x=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Wind").getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Wind").getValueByString("Y").toFloat(),t}getSubRigCount(){return this._json.getRoot().getValueByString(e).getValueByString("PhysicsSettingCount").toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(e).getValueByString("TotalInputCount").toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(e).getValueByString("TotalOutputCount").toInt()}getVertexCount(){return this._json.getRoot().getValueByString(e).getValueByString("VertexCount").toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Minimum").toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Maximum").toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Default").toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Minimum").toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Maximum").toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Default").toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Weight").toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Reflect").toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Type").getRawString()}getInputSourceId(t,e){return Jt.getIdManager().getId(this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Source").getValueByString("Id").getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("VertexIndex").toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Scale").toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Weight").toFloat()}getOutputDestinationId(t,e){return Jt.getIdManager().getId(this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Destination").getValueByString("Id").getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Type").getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Reflect").toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Mobility").toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Delay").toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Acceleration").toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Radius").toInt()}getParticlePosition(t,e){const s=new $t(0,0);return s.x=this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Position").getValueByString("X").toFloat(),s.y=this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Position").getValueByString("Y").toFloat(),s}}}(Wt||(Wt={}));var Zt,Qt,te=Wt.CubismPhysicsJson,ee=U.CubismMath,ie=qt.CubismPhysicsRig,se=qt.CubismPhysicsSubRig,re=qt.CubismPhysicsInput,ae=qt.CubismPhysicsOutput,ne=qt.CubismPhysicsParticle,oe=qt.CubismPhysicsSource,le=qt.CubismPhysicsTargetType,ue=k.CubismVector2;!function(t){class e{constructor(){this._physicsRig=null,this._options=new i,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0}static create(t,i){const s=new e;return s.parse(t,i),s._physicsRig.gravity.y=0,s}static delete(t){null!=t&&(t.release(),t=null)}evaluate(t,e){let i,s,r,a;const n=new ue;let o,l,u,h,g,d,m,p;g=t.getModel().parameters.values,d=t.getModel().parameters.maximumValues,m=t.getModel().parameters.minimumValues,p=t.getModel().parameters.defaultValues;for(let y=0;y<this._physicsRig.subRigCount;++y){i={angle:0},n.x=0,n.y=0,o=this._physicsRig.settings.at(y),l=this._physicsRig.inputs.get(o.baseInputIndex),u=this._physicsRig.outputs.get(o.baseOutputIndex),h=this._physicsRig.particles.get(o.baseParticleIndex);for(let e=0;e<o.inputCount;++e)s=l[e].weight/100,-1==l[e].sourceParameterIndex&&(l[e].sourceParameterIndex=t.getParameterIndex(l[e].source.id)),l[e].getNormalizedParameterValue(n,i,g[l[e].sourceParameterIndex],m[l[e].sourceParameterIndex],d[l[e].sourceParameterIndex],p[l[e].sourceParameterIndex],o.normalizationPosition,o.normalizationAngle,l[0].reflect,s);r=ee.degreesToRadian(-i.angle),n.x=n.x*ee.cos(r)-n.y*ee.sin(r),n.y=n.x*ee.sin(r)+n.y*ee.cos(r),c(h,o.particleCount,n,i.angle,this._options.wind,.001*o.normalizationPosition.maximum,e,5);for(let e=0;e<o.outputCount;++e){const i=u[e].vertexIndex;if(i<1||i>=o.particleCount)break;-1==u[e].destinationParameterIndex&&(u[e].destinationParameterIndex=t.getParameterIndex(u[e].destination.id));const s=new ue;s.x=h[i].position.x-h[i-1].position.x,s.y=h[i].position.y-h[i-1].position.y,a=u[e].getValue(s,h,i,u[e].reflect,this._options.gravity);const r=u[e].destinationParameterIndex,n=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(g.subarray(r))):g.slice(r);_(n,m[r],d[r],a,u[e]);for(let t=r,e=0;t<g.length;t++,e++)g[t]=n[e]}}}setOptions(t){this._options=t}getOption(){return this._options}release(){this._physicsRig=void 0,this._physicsRig=null}parse(t,e){this._physicsRig=new ie;let i=new te(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,se,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),re,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),ae,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),ne,!0);let u=0,c=0,_=0;for(let t=0;t<this._physicsRig.settings.getSize();++t){this._physicsRig.settings.at(t).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(t),this._physicsRig.settings.at(t).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(t),this._physicsRig.settings.at(t).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(t),this._physicsRig.settings.at(t).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(t),this._physicsRig.settings.at(t).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(t),this._physicsRig.settings.at(t).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(t),this._physicsRig.settings.at(t).inputCount=i.getInputCount(t),this._physicsRig.settings.at(t).baseInputIndex=u;for(let e=0;e<this._physicsRig.settings.at(t).inputCount;++e)this._physicsRig.inputs.at(u+e).sourceParameterIndex=-1,this._physicsRig.inputs.at(u+e).weight=i.getInputWeight(t,e),this._physicsRig.inputs.at(u+e).reflect=i.getInputReflect(t,e),"X"==i.getInputType(t,e)?(this._physicsRig.inputs.at(u+e).type=oe.CubismPhysicsSource_X,this._physicsRig.inputs.at(u+e).getNormalizedParameterValue=s):"Y"==i.getInputType(t,e)?(this._physicsRig.inputs.at(u+e).type=oe.CubismPhysicsSource_Y,this._physicsRig.inputs.at(u+e).getNormalizedParameterValue=r):"Angle"==i.getInputType(t,e)&&(this._physicsRig.inputs.at(u+e).type=oe.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(u+e).getNormalizedParameterValue=a),this._physicsRig.inputs.at(u+e).source.targetType=le.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(u+e).source.id=i.getInputSourceId(t,e);u+=this._physicsRig.settings.at(t).inputCount,this._physicsRig.settings.at(t).outputCount=i.getOutputCount(t),this._physicsRig.settings.at(t).baseOutputIndex=c;for(let e=0;e<this._physicsRig.settings.at(t).outputCount;++e)this._physicsRig.outputs.at(c+e).destinationParameterIndex=-1,this._physicsRig.outputs.at(c+e).vertexIndex=i.getOutputVertexIndex(t,e),this._physicsRig.outputs.at(c+e).angleScale=i.getOutputAngleScale(t,e),this._physicsRig.outputs.at(c+e).weight=i.getOutputWeight(t,e),this._physicsRig.outputs.at(c+e).destination.targetType=le.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(c+e).destination.id=i.getOutputDestinationId(t,e),"X"==i.getOutputType(t,e)?(this._physicsRig.outputs.at(c+e).type=oe.CubismPhysicsSource_X,this._physicsRig.outputs.at(c+e).getValue=n,this._physicsRig.outputs.at(c+e).getScale=h):"Y"==i.getOutputType(t,e)?(this._physicsRig.outputs.at(c+e).type=oe.CubismPhysicsSource_Y,this._physicsRig.outputs.at(c+e).getValue=o,this._physicsRig.outputs.at(c+e).getScale=g):"Angle"==i.getOutputType(t,e)&&(this._physicsRig.outputs.at(c+e).type=oe.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(c+e).getValue=l,this._physicsRig.outputs.at(c+e).getScale=d),this._physicsRig.outputs.at(c+e).reflect=i.getOutputReflect(t,e);c+=this._physicsRig.settings.at(t).outputCount,this._physicsRig.settings.at(t).particleCount=i.getParticleCount(t),this._physicsRig.settings.at(t).baseParticleIndex=_;for(let e=0;e<this._physicsRig.settings.at(t).particleCount;++e)this._physicsRig.particles.at(_+e).mobility=i.getParticleMobility(t,e),this._physicsRig.particles.at(_+e).delay=i.getParticleDelay(t,e),this._physicsRig.particles.at(_+e).acceleration=i.getParticleAcceleration(t,e),this._physicsRig.particles.at(_+e).radius=i.getParticleRadius(t,e),this._physicsRig.particles.at(_+e).position=i.getParticlePosition(t,e);_+=this._physicsRig.settings.at(t).particleCount}this.initialize(),i.release(),i=void 0,i=null}initialize(){let t,e,i;for(let s=0;s<this._physicsRig.subRigCount;++s){e=this._physicsRig.settings.at(s),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new ue(0,0),t[0].lastPosition=new ue(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new ue(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new ue(0,0),t[0].force=new ue(0,0);for(let s=1;s<e.particleCount;++s)i=new ue(0,0),i.y=t[s].radius,t[s].initialPosition=new ue(t[s-1].initialPosition.x+i.x,t[s-1].initialPosition.y+i.y),t[s].position=new ue(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastPosition=new ue(t[s].initialPosition.x,t[s].initialPosition.y),t[s].lastGravity=new ue(0,-1),t[s].lastGravity.y*=-1,t[s].velocity=new ue(0,0),t[s].force=new ue(0,0)}}}t.CubismPhysics=e;class i{constructor(){this.gravity=new ue(0,0),this.wind=new ue(0,0)}}function s(t,e,i,s,r,a,n,o,l,u){t.x+=m(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*u}function r(t,e,i,s,r,a,n,o,l,u){t.y+=m(i,s,r,a,n.minimum,n.maximum,n.defalut,l)*u}function a(t,e,i,s,r,a,n,o,l,u){e.angle+=m(i,s,r,a,o.minimum,o.maximum,o.defalut,l)*u}function n(t,e,i,s,r){let a=t.x;return s&&(a*=-1),a}function o(t,e,i,s,r){let a=t.y;return s&&(a*=-1),a}function l(t,e,i,s,r){let a;return r=i>=2?e[i-1].position.substract(e[i-2].position):r.multiplyByScaler(-1),a=ee.directionToRadian(r,t),s&&(a*=-1),a}function u(t,e){return ee.min(t,e)+function(t,e){const i=ee.max(t,e),s=ee.min(t,e);return ee.abs(i-s)}(t,e)/2}function h(t,e){return JSON.parse(JSON.stringify(t.x))}function g(t,e){return JSON.parse(JSON.stringify(t.y))}function d(t,e){return JSON.parse(JSON.stringify(e))}function c(t,e,i,s,r,a,n,o){let l,u,h,g,d=new ue(0,0),c=new ue(0,0),_=new ue(0,0),m=new ue(0,0);t[0].position=new ue(i.x,i.y),l=ee.degreesToRadian(s),g=ee.radianToDirection(l),g.normalize();for(let i=1;i<e;++i)t[i].force=g.multiplyByScaler(t[i].acceleration).add(r),t[i].lastPosition=new ue(t[i].position.x,t[i].position.y),u=t[i].delay*n*30,d=t[i].position.substract(t[i-1].position),h=ee.directionToRadian(t[i].lastGravity,g)/o,d.x=ee.cos(h)*d.x-d.y*ee.sin(h),d.y=ee.sin(h)*d.x+d.y*ee.cos(h),t[i].position=t[i-1].position.add(d),c=t[i].velocity.multiplyByScaler(u),_=t[i].force.multiplyByScaler(u).multiplyByScaler(u),t[i].position=t[i].position.add(c).add(_),m=t[i].position.substract(t[i-1].position),m.normalize(),t[i].position=t[i-1].position.add(m.multiplyByScaler(t[i].radius)),ee.abs(t[i].position.x)<a&&(t[i].position.x=0),0!=u&&(t[i].velocity=t[i].position.substract(t[i].lastPosition),t[i].velocity=t[i].velocity.divisionByScalar(u),t[i].velocity=t[i].velocity.multiplyByScaler(t[i].mobility)),t[i].force=new ue(0,0),t[i].lastGravity=new ue(g.x,g.y)}function _(t,e,i,s,r){let a,n,o;a=r.getScale(r.translationScale,r.angleScale),n=s*a,n<e?(n<r.valueBelowMinimum&&(r.valueBelowMinimum=n),n=e):n>i&&(n>r.valueExceededMaximum&&(r.valueExceededMaximum=n),n=i),o=r.weight/100,o>=1?t[0]=n:(n=t[0]*(1-o)+n*o,t[0]=n)}function m(t,e,i,s,r,a,n,o){let l=0;const h=ee.max(i,e);h<t&&(t=h);const g=ee.min(i,e);g>t&&(t=g);const d=ee.min(r,a),c=ee.max(r,a),_=n,m=u(g,h),p=t-m;switch(function(t){let e=0;return t>0?e=1:t<0&&(e=-1),e}(p)){case 1:{const t=c-_,e=h-m;0!=e&&(l=p*(t/e),l+=_);break}case-1:{const t=d-_,e=g-m;0!=e&&(l=p*(t/e),l+=_);break}case 0:l=_}return o?l:-1*l}t.Options=i}(Zt||(Zt={})),function(t){class e{constructor(){this._currentTime=0}static create(){return new e}static delete(t){null!=t&&(t=null)}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=2*this._currentTime*3.14159;for(let e=0;e<this._breathParameters.getSize();++e){const s=this._breathParameters.at(e);t.addParameterValueById(s.parameterId,s.offset+s.peak*Math.sin(i/s.cycle),s.weight)}}}t.CubismBreath=e;t.BreathParameterData=class{constructor(t,e,i,s,r){this.parameterId=null==t?null:t,this.offset=null==e?0:e,this.peak=null==i?0:i,this.cycle=null==s?0:s,this.weight=null==r?0:r}}}(Qt||(Qt={}));var he,ge,de=c.csmVector;!function(t){class e{constructor(t){if(this._blinkingState=i.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new de,null!=t)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}static create(t=null){return new e(t)}static delete(t){null!=t&&(t=null)}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,s){let r;this._userTimeSeconds+=s;let a=0;switch(this._blinkingState){case i.EyeState_Closing:a=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,a>=1&&(a=1,this._blinkingState=i.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),r=1-a;break;case i.EyeState_Closed:a=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,a>=1&&(this._blinkingState=i.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),r=0;break;case i.EyeState_Opening:a=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,a>=1&&(a=1,this._blinkingState=i.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),r=a;break;case i.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=i.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),r=1;break;case i.EyeState_First:default:this._blinkingState=i.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),r=1}e.CloseIfZero||(r=-r);for(let e=0;e<this._parameterIds.getSize();++e)t.setParameterValueById(this._parameterIds.at(e),r)}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}}let i;e.CloseIfZero=!0,t.CubismEyeBlink=e,function(t){t[t.EyeState_First=0]="EyeState_First",t[t.EyeState_Interval=1]="EyeState_Interval",t[t.EyeState_Closing=2]="EyeState_Closing",t[t.EyeState_Closed=3]="EyeState_Closed",t[t.EyeState_Opening=4]="EyeState_Opening"}(i=t.EyeState||(t.EyeState={}))}(he||(he={})),function(t){t.csmRect=class{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e}}}(ge||(ge={}));var ce,_e=v.Constant,me=C.CubismMatrix44,pe=ge.csmRect,ye=d.csmMap,fe=c.csmVector,Se=b.CubismRenderer,xe=b.CubismBlendMode,Ce=b.CubismTextureColor;!function(t){let e,i,s,r;class a{constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new fe,this._clippingContextListForDraw=new fe,this._channelColors=new fe,this._tmpBoundsOnModel=new pe,this._tmpMatrix=new me,this._tmpMatrixForMask=new me,this._tmpMatrixForDraw=new me,this._maskTexture=null;let t=new Ce;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new Ce,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new Ce,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new Ce,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){let t=0;if(this._maskTexture&&0!=this._maskTexture.texture&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),0==t){const e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s),this._maskTexture=new n(this._currentFrameNo,t)}return t}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,r=Number.MIN_VALUE,a=Number.MIN_VALUE;const n=e._clippedDrawableIndexList.length;for(let o=0;o<n;o++){const n=e._clippedDrawableIndexList[o],l=t.getDrawableVertexCount(n),u=t.getDrawableVertices(n);let h=Number.MAX_VALUE,g=Number.MAX_VALUE,d=Number.MIN_VALUE,c=Number.MIN_VALUE;const _=l*_e.vertexStep;for(let t=_e.vertexOffset;t<_;t+=_e.vertexStep){const e=u[t],i=u[t+1];e<h&&(h=e),e>d&&(d=e),i<g&&(g=i),i>c&&(c=i)}if(h!=Number.MAX_VALUE)if(h<i&&(i=h),g<s&&(s=g),d>r&&(r=d),c>a&&(a=c),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const t=r-i,n=a-s;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=s,e._allClippedDrawRect.width=t,e._allClippedDrawRect.height=n}}}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null,this._maskTexture&&(this.gl.deleteFramebuffer(this._maskTexture.texture),this._maskTexture=null);for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this.gl.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(t,e,i,s){for(let t=0;t<e;t++){if(s[t]<=0){this._clippingContextListForDraw.pushBack(null);continue}let e=this.findSameClip(i[t],s[t]);null==e&&(e=new o(this,i[t],s[t]),this._clippingContextListForMask.pushBack(e)),e.addClippedDrawable(t),this._clippingContextListForDraw.pushBack(e)}}setupClippingContext(t,e){this._currentFrameNo++;let r=0;for(let e=0;e<this._clippingContextListForMask.getSize();e++){const i=this._clippingContextListForMask.at(e);this.calcClippedDrawTotalBounds(t,i),i._isUsing&&r++}if(r>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture();e.getMvpMatrix();e.preDraw(),this.setupLayoutBounds(r),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let i=0;i<this._clippingContextListForMask.getSize();i++){const s=this._clippingContextListForMask.at(i),r=s._allClippedDrawRect,a=s._layoutBounds,n=.05;this._tmpBoundsOnModel.setRect(r),this._tmpBoundsOnModel.expand(r.width*n,r.height*n);const o=a.width/this._tmpBoundsOnModel.width,l=a.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(o,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(o,l),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),s._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),s._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const u=s._clippingIdCount;for(let i=0;i<u;i++){const r=s._clippingIdList[i];t.getDrawableDynamicFlagVertexPositionsDidChange(r)&&(e.setIsCulling(0!=t.getDrawableCulling(r)),e.setClippingContextBufferForMask(s),e.drawMesh(t.getDrawableTextureIndices(r),t.getDrawableVertexIndexCount(r),t.getDrawableVertexCount(r),t.getDrawableVertexIndices(r),t.getDrawableVertices(r),t.getDrawableVertexUvs(r),t.getDrawableOpacity(r),xe.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s),e.setClippingContextBufferForMask(null),this.gl.viewport(i[0],i[1],i[2],i[3])}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const s=this._clippingContextListForMask.at(i),r=s._clippingIdCount;if(r!=e)continue;let a=0;for(let e=0;e<r;e++){const i=s._clippingIdList[e];for(let e=0;e<r;e++)if(t[e]==i){a++;break}}if(a==r)return s}return null}setupLayoutBounds(t){let e=t/4,i=t%4;e=~~e,i=~~i;let s=0;for(let t=0;t<4;t++){const r=e+(t<i?1:0);if(0==r);else if(1==r){const e=this._clippingContextListForMask.at(s++);e._layoutChannelNo=t,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1}else if(2==r)for(let e=0;e<r;e++){let i=e%2;i=~~i;const r=this._clippingContextListForMask.at(s++);r._layoutChannelNo=t,r._layoutBounds.x=.5*i,r._layoutBounds.y=0,r._layoutBounds.width=.5,r._layoutBounds.height=1}else if(r<=4)for(let e=0;e<r;e++){let i=e%2,r=e/2;i=~~i,r=~~r;const a=this._clippingContextListForMask.at(s++);a._layoutChannelNo=t,a._layoutBounds.x=.5*i,a._layoutBounds.y=.5*r,a._layoutBounds.width=.5,a._layoutBounds.height=.5}else if(r<=9)for(let e=0;e<r;e++){let i=e%3,r=e/3;i=~~i,r=~~r;const a=this._clippingContextListForMask.at(s++);a._layoutChannelNo=t,a._layoutBounds.x=i/3,a._layoutBounds.y=r/3,a._layoutBounds.width=1/3,a._layoutBounds.height=1/3}else h("not supported mask count : {0}",r)}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}}t.CubismClippingManager_WebGL=a;class n{constructor(t,e){this.frameNo=t,this.texture=e}}t.CubismRenderTextureResource=n;class o{constructor(t,e,i){this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new pe,this._layoutBounds=new pe,this._clippedDrawableIndexList=[],this._matrixForMask=new me,this._matrixForDraw=new me}release(){null!=this._layoutBounds&&(this._layoutBounds=null),null!=this._allClippedDrawRect&&(this._allClippedDrawRect=null),null!=this._clippedDrawableIndexList&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}t.CubismClippingContext=o;class l{constructor(){this._shaderSets=new fe}static getInstance(){return null==e?(e=new l,e):e}static deleteInstance(){e&&(e.release(),e=null)}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,s,a,n,o,l,g,d,c,_,m){let p,y,f,S;if(c||h("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders(),null!=t.getClippingContextBufferForMask()){const i=this._shaderSets.at(r.ShaderNames_SetupMask);this.gl.useProgram(i.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(i.samplerTexture0Location,0),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(i.attributePositionLocation),this.gl.vertexAttribPointer(i.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(i.attributeTexCoordLocation),this.gl.vertexAttribPointer(i.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const a=t.getClippingContextBufferForMask()._layoutChannelNo,l=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(a);this.gl.uniform4f(i.uniformChannelFlagLocation,l.R,l.G,l.B,l.A),this.gl.uniformMatrix4fv(i.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const u=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(i.uniformBaseColorLocation,2*u.x-1,2*u.y-1,2*u.getRight()-1,2*u.getBottom()-1),p=this.gl.ZERO,y=this.gl.ONE_MINUS_SRC_COLOR,f=this.gl.ZERO,S=this.gl.ONE_MINUS_SRC_ALPHA}else{const i=null!=t.getClippingContextBufferForDraw(),a=i?m?2:1:0;let l=new u;switch(g){case xe.CubismBlendMode_Normal:default:l=this._shaderSets.at(r.ShaderNames_NormalPremultipliedAlpha+a),p=this.gl.ONE,y=this.gl.ONE_MINUS_SRC_ALPHA,f=this.gl.ONE,S=this.gl.ONE_MINUS_SRC_ALPHA;break;case xe.CubismBlendMode_Additive:l=this._shaderSets.at(r.ShaderNames_AddPremultipliedAlpha+a),p=this.gl.ONE,y=this.gl.ONE,f=this.gl.ZERO,S=this.gl.ONE;break;case xe.CubismBlendMode_Multiplicative:l=this._shaderSets.at(r.ShaderNames_MultPremultipliedAlpha+a),p=this.gl.DST_COLOR,y=this.gl.ONE_MINUS_SRC_ALPHA,f=this.gl.ZERO,S=this.gl.ONE}if(this.gl.useProgram(l.shaderProgram),null==o.vertex&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(l.attributePositionLocation),this.gl.vertexAttribPointer(l.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==o.uv&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(l.attributeTexCoordLocation),this.gl.vertexAttribPointer(l.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),i){this.gl.activeTexture(this.gl.TEXTURE1);const e=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(l.samplerTexture1Location,1),this.gl.uniformMatrix4fv(l.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const i=t.getClippingContextBufferForDraw()._layoutChannelNo,s=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(l.uniformChannelFlagLocation,s.R,s.G,s.B,s.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(l.samplerTexture0Location,0),this.gl.uniformMatrix4fv(l.uniformMatrixLocation,!1,_.getArray()),this.gl.uniform4f(l.uniformBaseColorLocation,d.R,d.G,d.B,d.A)}null==o.index&&(o.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(p,y,f,S)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<10;t++)this._shaderSets.pushBack(new u);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(t.vertexShaderSrcSetupMask,t.fragmentShaderSrcsetupMask),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(t.vertexShaderSrc,t.fragmentShaderSrcPremultipliedAlpha),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(t.vertexShaderSrcMasked,t.fragmentShaderSrcMaskPremultipliedAlpha),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(t.vertexShaderSrcMasked,t.fragmentShaderSrcMaskInvertedPremultipliedAlpha),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),s=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!s)return h("Vertex shader compile error!"),0;let r=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);if(!r)return h("Vertex shader compile error!"),0;return this.gl.attachShader(i,s),this.gl.attachShader(i,r),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(s),this.gl.deleteShader(r),i):(h("Failed to link program: {0}",i),this.gl.deleteShader(s),s=0,this.gl.deleteShader(r),r=0,i&&(this.gl.deleteProgram(i),i=0),0)}compileShaderSource(t,e){const i=e,s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!s){const t=this.gl.getShaderInfoLog(s);h("Shader compile log: {0} ",t)}return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.deleteShader(s),null)}setGl(t){this.gl=t}}t.CubismShader_WebGL=l;class u{}t.CubismShaderSet=u,function(t){t[t.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",t[t.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",t[t.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",t[t.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",t[t.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",t[t.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted"}(r=t.ShaderNames||(t.ShaderNames={})),t.vertexShaderSrcSetupMask="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",t.fragmentShaderSrcsetupMask="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",t.vertexShaderSrc="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",t.vertexShaderSrcMasked="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",t.fragmentShaderSrcPremultipliedAlpha="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;void main(){   gl_FragColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;}",t.fragmentShaderSrcMaskPremultipliedAlpha="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;void main(){   vec4 col_formask = texture2D(s_texture0 , v_texCoord) * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",t.fragmentShaderSrcMaskInvertedPremultipliedAlpha="precision mediump float;varying vec2 v_texCoord;varying vec4 v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4 u_channelFlag;uniform vec4 u_baseColor;void main(){vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;col_formask = col_formask * (1.0 - maskVal);gl_FragColor = col_formask;}";class g extends Se{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new a,this.firstDraw=!0,this._textures=new ye,this._sortedDrawableIndexList=new fe,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}initialize(t){t.isUsingMasking()&&(this._clippingManager=new a,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts())),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new a,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}release(){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null}doDrawModel(){null!=this._clippingManager&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const t=e[i];this._sortedDrawableIndexList.set(t,i)}for(let e=0;e<t;++e){const t=this._sortedDrawableIndexList.at(e);this.getModel().getDrawableDynamicFlagIsVisible(t)&&(this.setClippingContextBufferForDraw(null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw().at(t):null),this.setIsCulling(this.getModel().getDrawableCulling(t)),this.drawMesh(this.getModel().getDrawableTextureIndices(t),this.getModel().getDrawableVertexIndexCount(t),this.getModel().getDrawableVertexCount(t),this.getModel().getDrawableVertexIndices(t),this.getModel().getDrawableVertices(t),this.getModel().getDrawableVertexUvs(t),this.getModel().getDrawableOpacity(t),this.getModel().getDrawableBlendMode(t),this.getModel().getDrawableInvertedMaskBit(t)))}}drawMesh(t,e,i,s,r,a,n,o,u){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const h=this.getModelColor();let g;null==this.getClippingContextBufferForMask()&&(h.A*=n,this.isPremultipliedAlpha()&&(h.R*=h.A,h.G*=h.A,h.B*=h.A)),g=null!=this._textures.getValue(t)?this._textures.getValue(t):null,l.getInstance().setupShaderProgram(this,g,i,r,s,a,this._bufferData,n,o,h,this.isPremultipliedAlpha(),this.getMvpMatrix(),u),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){l.deleteInstance()}setRenderState(t,e){s=t,i=e}preDraw(){this.firstDraw&&(this.firstDraw=!1,this._anisortopy=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager.setGL(t),l.getInstance().setGl(t)}}t.CubismRenderer_WebGL=g,Se.staticRelease=()=>{g.doStaticRelease()}}(ce||(ce={}));var Be,Me,be=ce.CubismRenderer_WebGL,Pe=he.CubismEyeBlink,ve=Qt.CubismBreath,Ie=v.Constant,Ve=Zt.CubismPhysics,we=Ut.CubismModelUserData,Te=Lt.CubismPose,Ee=Vt.CubismExpressionMotion,Fe=mt.CubismMotion,Le=ot.CubismMoc,Re=tt.CubismModelMatrix,De=Z.CubismTargetPoint,Ae=$.CubismMotionManager;!function(t){class e{constructor(){this.loadMotion=(t,e,i,s)=>Fe.create(t,e,s),this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._debugMode=!1,this._renderer=null,this._motionManager=new Ae,this._motionManager.setEventCallback(e.cubismDefaultMotionEventCallback,this),this._expressionManager=new Ae,this._dragManager=new De}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t){this._moc=Le.create(t),this._model=this._moc.createModel(),this._model.saveParameters(),null!=this._moc&&null!=this._model?this._modelMatrix=new Re(this._model.getCanvasWidth(),this._model.getCanvasHeight()):h("Failed to CreateModel().")}loadExpression(t,e,i){return Ee.create(t,e)}loadPose(t,e){this._pose=Te.create(t,e)}loadUserData(t,e){this._modelUserData=we.create(t,e)}loadPhysics(t,e){this._physics=Ve.create(t,e)}isHit(t,e,i){const s=this._model.getDrawableIndex(t);if(s<0)return!1;const r=this._model.getDrawableVertexCount(s),a=this._model.getDrawableVertices(s);let n=a[0],o=a[0],l=a[1],u=a[1];for(let t=1;t<r;++t){const e=a[Ie.vertexOffset+t*Ie.vertexStep],i=a[Ie.vertexOffset+t*Ie.vertexStep+1];e<n&&(n=e),e>o&&(o=e),i<l&&(l=i),i>u&&(u=i)}const h=this._modelMatrix.invertTransformX(e),g=this._modelMatrix.invertTransformY(i);return n<=h&&h<=o&&l<=g&&g<=u}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(){this._renderer&&this.deleteRenderer(),this._renderer=new be,this._renderer.initialize(this._model)}deleteRenderer(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){l("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){null!=i&&i.motionEventFired(e)}release(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Te.delete(this._pose),Pe.delete(this._eyeBlink),ve.delete(this._breath),this._dragManager=null,Ve.delete(this._physics),we.delete(this._modelUserData),this.deleteRenderer()}}t.CubismUserModel=e}(Be||(Be={})),function(t){t.ICubismModelSetting=class{}}(Me||(Me={}));var ke,Ne,Oe=c.csmVector,Ue=v.CubismFramework,ze=_.CubismJson,Xe=Me.ICubismModelSetting;!function(t){const e="Name";let i;!function(t){t[t.FrequestNode_Groups=0]="FrequestNode_Groups",t[t.FrequestNode_Moc=1]="FrequestNode_Moc",t[t.FrequestNode_Motions=2]="FrequestNode_Motions",t[t.FrequestNode_Expressions=3]="FrequestNode_Expressions",t[t.FrequestNode_Textures=4]="FrequestNode_Textures",t[t.FrequestNode_Physics=5]="FrequestNode_Physics",t[t.FrequestNode_Pose=6]="FrequestNode_Pose",t[t.FrequestNode_HitAreas=7]="FrequestNode_HitAreas"}(i||(i={}));t.CubismModelSettingJson=class extends Xe{constructor(t,e){super(),this._json=ze.create(t,e),this._json&&(this._jsonValue=new Oe,this._jsonValue.pushBack(this._json.getRoot().getValueByString("Groups")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Moc")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Motions")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Expressions")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Textures")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Physics")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("FileReferences").getValueByString("Pose")),this._jsonValue.pushBack(this._json.getRoot().getValueByString("HitAreas")))}release(){ze.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(i.FrequestNode_Moc).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(i.FrequestNode_Textures).getSize():0}getTextureDirectory(){return this._jsonValue.at(i.FrequestNode_Textures).getRawString()}getTextureFileName(t){return this._jsonValue.at(i.FrequestNode_Textures).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(i.FrequestNode_HitAreas).getSize():0}getHitAreaId(t){return Ue.getIdManager().getId(this._jsonValue.at(i.FrequestNode_HitAreas).getValueByIndex(t).getValueByString("Id").getRawString())}getHitAreaName(t){return this._jsonValue.at(i.FrequestNode_HitAreas).getValueByIndex(t).getValueByString(e).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(i.FrequestNode_Physics).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(i.FrequestNode_Pose).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(i.FrequestNode_Expressions).getSize():0}getExpressionName(t){return this._jsonValue.at(i.FrequestNode_Expressions).getValueByIndex(t).getValueByString(e).getRawString()}getExpressionFileName(t){return this._jsonValue.at(i.FrequestNode_Expressions).getValueByIndex(t).getValueByString("File").getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(i.FrequestNode_Motions).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(i.FrequestNode_Motions).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString("File").getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString("Sound").getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString("FadeInTime").toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString("FadeOutTime").toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString("FileReferences").getValueByString("UserData").getRawString():""}getLayoutMap(t){const e=this._json.getRoot().getValueByString("Layout").getMap();if(null==e)return!1;let i=!1;for(const s=e.begin();s.notEqual(e.end());s.preIncrement())t.setValue(s.ptr().first,s.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let s=0;s<this._jsonValue.at(i.FrequestNode_Groups).getSize();s++){const r=this._jsonValue.at(i.FrequestNode_Groups).getValueByIndex(s);if(!r.isNull()&&!r.isError()&&"EyeBlink"==r.getValueByString(e).getRawString()){t=r.getValueByString("Ids").getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let s=0;s<this._jsonValue.at(i.FrequestNode_Groups).getSize();s++){const r=this._jsonValue.at(i.FrequestNode_Groups).getValueByIndex(s);if(!r.isNull()&&!r.isError()&&"EyeBlink"==r.getValueByString(e).getRawString())return Ue.getIdManager().getId(r.getValueByString("Ids").getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let s=0;s<this._jsonValue.at(i.FrequestNode_Groups).getSize();s++){const r=this._jsonValue.at(i.FrequestNode_Groups).getValueByIndex(s);if(!r.isNull()&&!r.isError()&&"LipSync"==r.getValueByString(e).getRawString()){t=r.getValueByString("Ids").getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let s=0;s<this._jsonValue.at(i.FrequestNode_Groups).getSize();s++){const r=this._jsonValue.at(i.FrequestNode_Groups).getValueByIndex(s);if(!r.isNull()&&!r.isError()&&"LipSync"==r.getValueByString(e).getRawString())return Ue.getIdManager().getId(r.getValueByString("Ids").getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(i.FrequestNode_Moc);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(i.FrequestNode_Textures);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(i.FrequestNode_HitAreas);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(i.FrequestNode_Physics);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(i.FrequestNode_Pose);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(i.FrequestNode_Expressions);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(i.FrequestNode_Motions);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const s=this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString("Sound");return!s.isNull()&&!s.isError()}isExistMotionFadeIn(t,e){const s=this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString("FadeInTime");return!s.isNull()&&!s.isError()}isExistMotionFadeOut(t,e){const s=this._jsonValue.at(i.FrequestNode_Motions).getValueByString(t).getValueByIndex(e).getValueByString("FadeOutTime");return!s.isNull()&&!s.isError()}isExistUserDataFile(){const t=this._json.getRoot().getValueByString("FileReferences").getValueByString("UserData");return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(i.FrequestNode_Groups).isNull()||this._jsonValue.at(i.FrequestNode_Groups).isError())return!1;for(let t=0;t<this._jsonValue.at(i.FrequestNode_Groups).getSize();++t)if("EyeBlink"==this._jsonValue.at(i.FrequestNode_Groups).getValueByIndex(t).getValueByString(e).getRawString())return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(i.FrequestNode_Groups).isNull()||this._jsonValue.at(i.FrequestNode_Groups).isError())return!1;for(let t=0;t<this._jsonValue.at(i.FrequestNode_Groups).getSize();++t)if("LipSync"==this._jsonValue.at(i.FrequestNode_Groups).getValueByIndex(t).getValueByString(e).getRawString())return!0;return!1}}}(ke||(ke={})),function(t){t.HitAreaPrefix="HitArea",t.HitAreaHead="Head",t.HitAreaBody="Body",t.PartsIdCore="Parts01Core",t.PartsArmPrefix="Parts01Arm_",t.PartsArmLPrefix="Parts01ArmL_",t.PartsArmRPrefix="Parts01ArmR_",t.ParamAngleX="ParamAngleX",t.ParamAngleY="ParamAngleY",t.ParamAngleZ="ParamAngleZ",t.ParamEyeLOpen="ParamEyeLOpen",t.ParamEyeLSmile="ParamEyeLSmile",t.ParamEyeROpen="ParamEyeROpen",t.ParamEyeRSmile="ParamEyeRSmile",t.ParamEyeBallX="ParamEyeBallX",t.ParamEyeBallY="ParamEyeBallY",t.ParamEyeBallForm="ParamEyeBallForm",t.ParamBrowLY="ParamBrowLY",t.ParamBrowRY="ParamBrowRY",t.ParamBrowLX="ParamBrowLX",t.ParamBrowRX="ParamBrowRX",t.ParamBrowLAngle="ParamBrowLAngle",t.ParamBrowRAngle="ParamBrowRAngle",t.ParamBrowLForm="ParamBrowLForm",t.ParamBrowRForm="ParamBrowRForm",t.ParamMouthForm="ParamMouthForm",t.ParamMouthOpenY="ParamMouthOpenY",t.ParamCheek="ParamCheek",t.ParamBodyAngleX="ParamBodyAngleX",t.ParamBodyAngleY="ParamBodyAngleY",t.ParamBodyAngleZ="ParamBodyAngleZ",t.ParamBreath="ParamBreath",t.ParamArmLA="ParamArmLA",t.ParamArmRA="ParamArmRA",t.ParamArmLB="ParamArmLB",t.ParamArmRB="ParamArmRB",t.ParamHandL="ParamHandL",t.ParamHandR="ParamHandR",t.ParamHairFront="ParamHairFront",t.ParamHairSide="ParamHairSide",t.ParamHairBack="ParamHairBack",t.ParamHairFluffy="ParamHairFluffy",t.ParamShoulderY="ParamShoulderY",t.ParamBustX="ParamBustX",t.ParamBustY="ParamBustY",t.ParamBaseX="ParamBaseX",t.ParamBaseY="ParamBaseY",t.ParamNONE="NONE:"}(Ne||(Ne={}));class je{static loadFileAsBytes(t,e){fetch(t).then(t=>t.arrayBuffer()).then(t=>e(t,t.byteLength))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(t){console.log(t)}}je.lastUpdate=Date.now(),je.s_currentFrame=0,je.s_lastFrame=0,je.s_deltaTime=0;const Ye=["clea"],qe=Ye.length,He=I.LogLevel_Verbose;var Ge="URLSearchParams"in self,We="Symbol"in self&&"iterator"in Symbol,Je="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),$e="FormData"in self,Ke="ArrayBuffer"in self;if(Ke)var Ze=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Qe=ArrayBuffer.isView||function(t){return t&&Ze.indexOf(Object.prototype.toString.call(t))>-1};function ti(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function ei(t){return"string"!=typeof t&&(t=String(t)),t}function ii(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return We&&(e[Symbol.iterator]=function(){return e}),e}function si(t){this.map={},t instanceof si?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function ri(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function ai(t){return new Promise((function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}}))}function ni(t){var e=new FileReader,i=ai(e);return e.readAsArrayBuffer(t),i}function oi(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function li(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:Je&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:$e&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:Ge&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():Ke&&Je&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=oi(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Ke&&(ArrayBuffer.prototype.isPrototypeOf(t)||Qe(t))?this._bodyArrayBuffer=oi(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ge&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Je&&(this.blob=function(){var t=ri(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?ri(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ni)}),this.text=function(){var t,e,i,s=ri(this);if(s)return s;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,i=ai(e),e.readAsText(t),i;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),i=new Array(e.length),s=0;s<e.length;s++)i[s]=String.fromCharCode(e[s]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},$e&&(this.formData=function(){return this.text().then(gi)}),this.json=function(){return this.text().then(JSON.parse)},this}si.prototype.append=function(t,e){t=ti(t),e=ei(e);var i=this.map[t];this.map[t]=i?i+", "+e:e},si.prototype.delete=function(t){delete this.map[ti(t)]},si.prototype.get=function(t){return t=ti(t),this.has(t)?this.map[t]:null},si.prototype.has=function(t){return this.map.hasOwnProperty(ti(t))},si.prototype.set=function(t,e){this.map[ti(t)]=ei(e)},si.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},si.prototype.keys=function(){var t=[];return this.forEach((function(e,i){t.push(i)})),ii(t)},si.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),ii(t)},si.prototype.entries=function(){var t=[];return this.forEach((function(e,i){t.push([i,e])})),ii(t)},We&&(si.prototype[Symbol.iterator]=si.prototype.entries);var ui=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function hi(t,e){var i,s,r=(e=e||{}).body;if(t instanceof hi){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new si(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new si(e.headers)),this.method=(i=e.method||this.method||"GET",s=i.toUpperCase(),ui.indexOf(s)>-1?s:i),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function gi(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var i=t.split("="),s=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(r))}})),e}function di(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new si(e.headers),this.url=e.url||"",this._initBody(t)}hi.prototype.clone=function(){return new hi(this,{body:this._bodyInit})},li.call(hi.prototype),li.call(di.prototype),di.prototype.clone=function(){return new di(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new si(this.headers),url:this.url})},di.error=function(){var t=new di(null,{status:0,statusText:""});return t.type="error",t};var ci=[301,302,303,307,308];di.redirect=function(t,e){if(-1===ci.indexOf(e))throw new RangeError("Invalid status code");return new di(null,{status:e,headers:{location:t}})};var _i=self.DOMException;try{new _i}catch(t){(_i=function(t,e){this.message=t,this.name=e;var i=Error(t);this.stack=i.stack}).prototype=Object.create(Error.prototype),_i.prototype.constructor=_i}function mi(t,e){return new Promise((function(i,s){var r=new hi(t,e);if(r.signal&&r.signal.aborted)return s(new _i("Aborted","AbortError"));var a=new XMLHttpRequest;function n(){a.abort()}a.onload=function(){var t,e,s={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new si,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var i=t.split(":"),s=i.shift().trim();if(s){var r=i.join(":").trim();e.append(s,r)}})),e)};s.url="responseURL"in a?a.responseURL:s.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;i(new di(r,s))},a.onerror=function(){s(new TypeError("Network request failed"))},a.ontimeout=function(){s(new TypeError("Network request failed"))},a.onabort=function(){s(new _i("Aborted","AbortError"))},a.open(r.method,r.url,!0),"include"===r.credentials?a.withCredentials=!0:"omit"===r.credentials&&(a.withCredentials=!1),"responseType"in a&&Je&&(a.responseType="blob"),r.headers.forEach((function(t,e){a.setRequestHeader(e,t)})),r.signal&&(r.signal.addEventListener("abort",n),a.onreadystatechange=function(){4===a.readyState&&r.signal.removeEventListener("abort",n)}),a.send(void 0===r._bodyInit?null:r._bodyInit)}))}mi.polyfill=!0,self.fetch||(self.fetch=mi,self.Headers=si,self.Request=hi,self.Response=di);var pi,yi=G.InvalidMotionQueueEntryHandleValue,fi=d.csmMap,Si=c.csmVector,xi=Qt.CubismBreath,Ci=Qt.BreathParameterData,Bi=he.CubismEyeBlink,Mi=X.ACubismMotion,bi=v.CubismFramework,Pi=Be.CubismUserModel,vi=ke.CubismModelSettingJson,Ii=Ne;!function(t){t[t.LoadAssets=0]="LoadAssets",t[t.LoadModel=1]="LoadModel",t[t.WaitLoadModel=2]="WaitLoadModel",t[t.LoadExpression=3]="LoadExpression",t[t.WaitLoadExpression=4]="WaitLoadExpression",t[t.LoadPhysics=5]="LoadPhysics",t[t.WaitLoadPhysics=6]="WaitLoadPhysics",t[t.LoadPose=7]="LoadPose",t[t.WaitLoadPose=8]="WaitLoadPose",t[t.SetupEyeBlink=9]="SetupEyeBlink",t[t.SetupBreath=10]="SetupBreath",t[t.LoadUserData=11]="LoadUserData",t[t.WaitLoadUserData=12]="WaitLoadUserData",t[t.SetupEyeBlinkIds=13]="SetupEyeBlinkIds",t[t.SetupLipSyncIds=14]="SetupLipSyncIds",t[t.SetupLayout=15]="SetupLayout",t[t.LoadMotion=16]="LoadMotion",t[t.WaitLoadMotion=17]="WaitLoadMotion",t[t.CompleteInitialize=18]="CompleteInitialize",t[t.CompleteSetupModel=19]="CompleteSetupModel",t[t.LoadTexture=20]="LoadTexture",t[t.WaitLoadTexture=21]="WaitLoadTexture",t[t.CompleteSetup=22]="CompleteSetup"}(pi||(pi={}));class Vi extends Pi{constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new Si,this._lipSyncIds=new Si,this._motions=new fi,this._expressions=new fi,this._hitArea=new Si,this._userArea=new Si,this._idParamAngleX=bi.getIdManager().getId(Ii.ParamAngleX),this._idParamAngleY=bi.getIdManager().getId(Ii.ParamAngleY),this._idParamAngleZ=bi.getIdManager().getId(Ii.ParamAngleZ),this._idParamEyeBallX=bi.getIdManager().getId(Ii.ParamEyeBallX),this._idParamEyeBallY=bi.getIdManager().getId(Ii.ParamEyeBallY),this._idParamBodyAngleX=bi.getIdManager().getId(Ii.ParamBodyAngleX),this._state=pi.LoadAssets,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0}loadAssets(t,e){this._modelHomeDir=t,fetch(`${this._modelHomeDir}/${e}`).then(t=>t.arrayBuffer()).then(t=>{const e=new vi(t,t.byteLength);this._state=pi.LoadModel,this.setupModel(e)})}setupModel(t){if(this._updating=!0,this._initialized=!1,this._modelSetting=t,""!=this._modelSetting.getModelFileName()){const t=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}/${t}`).then(t=>t.arrayBuffer()).then(t=>{this.loadModel(t),this._state=pi.LoadExpression,e()}),this._state=pi.WaitLoadModel}else je.printMessage("Model data does not exist.");const e=()=>{if(this._modelSetting.getExpressionCount()>0){const t=this._modelSetting.getExpressionCount();for(let e=0;e<t;e++){const s=this._modelSetting.getExpressionName(e),r=this._modelSetting.getExpressionFileName(e);fetch(`${this._modelHomeDir}/${r}`).then(t=>t.arrayBuffer()).then(e=>{const r=this.loadExpression(e,e.byteLength,s);null!=this._expressions.getValue(s)&&(Mi.delete(this._expressions.getValue(s)),this._expressions.setValue(s,null)),this._expressions.setValue(s,r),this._expressionCount++,this._expressionCount>=t&&(this._state=pi.LoadPhysics,i())})}this._state=pi.WaitLoadExpression}else this._state=pi.LoadPhysics,i()},i=()=>{if(""!=this._modelSetting.getPhysicsFileName()){const t=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}/${t}`).then(t=>t.arrayBuffer()).then(t=>{this.loadPhysics(t,t.byteLength),this._state=pi.LoadPose,s()}),this._state=pi.WaitLoadPhysics}else this._state=pi.LoadPose,s()},s=()=>{if(""!=this._modelSetting.getPoseFileName()){const t=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}/${t}`).then(t=>t.arrayBuffer()).then(t=>{this.loadPose(t,t.byteLength),this._state=pi.SetupEyeBlink,r()}),this._state=pi.WaitLoadPose}else this._state=pi.SetupEyeBlink,r()},r=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=Bi.create(this._modelSetting),this._eyeBlink._blinkingIntervalSeconds=8,this._state=pi.SetupBreath),a()},a=()=>{this._breath=xi.create();const t=new Si;t.pushBack(new Ci(this._idParamAngleX,0,15,6.5345,.5)),t.pushBack(new Ci(this._idParamAngleY,0,8,3.5345,.5)),t.pushBack(new Ci(this._idParamAngleZ,0,10,5.5345,.5)),t.pushBack(new Ci(this._idParamBodyAngleX,0,4,15.5345,.5)),t.pushBack(new Ci(bi.getIdManager().getId(Ii.ParamBreath),0,.5,3.2345,.5)),this._breath.setParameters(t),this._state=pi.LoadUserData,n()},n=()=>{if(""!=this._modelSetting.getUserDataFile()){const t=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}/${t}`).then(t=>t.arrayBuffer()).then(t=>{this.loadUserData(t,t.byteLength),this._state=pi.SetupEyeBlinkIds,o()}),this._state=pi.WaitLoadUserData}else this._state=pi.SetupEyeBlinkIds,o()},o=()=>{const t=this._modelSetting.getEyeBlinkParameterCount();for(let e=0;e<t;++e)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(e));this._state=pi.SetupLipSyncIds,l()},l=()=>{const t=this._modelSetting.getLipSyncParameterCount();for(let e=0;e<t;++e)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(e));this._state=pi.SetupLayout,u()},u=()=>{const t=new fi;this._modelSetting.getLayoutMap(t),this._modelMatrix.setupFromLayout(t),this._state=pi.LoadMotion,h()},h=()=>{this._state=pi.WaitLoadMotion,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const t=[],e=this._modelSetting.getMotionGroupCount();for(let i=0;i<e;i++)t[i]=this._modelSetting.getMotionGroupName(i),this._allMotionCount+=this._modelSetting.getMotionCount(t[i]);for(let i=0;i<e;i++)this.preLoadMotionGroup(t[i]);0==e&&(this._state=pi.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(ji))}}setupTextures(){if(this._state==pi.LoadTexture){const t=this._modelSetting.getTextureCount();for(let e=0;e<t;e++){if(""==this._modelSetting.getTextureFileName(e)){console.log("getTextureFileName null");continue}let i=this._modelSetting.getTextureFileName(e);i=this._modelHomeDir+i;const s=i=>{this.getRenderer().bindTexture(e,i.id),this._textureCount++,this._textureCount>=t&&(this._state=pi.CompleteSetup)};qi.getInstance().getTextureManager().createTextureFromPngFile(i,!0,s),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=pi.WaitLoadTexture}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=pi.CompleteSetup)return;const t=je.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let e=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion("Idle",1):e=this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),null!=this._eyeBlink&&this._eyeBlink.updateParameters(this._model,t),null!=this._expressionManager&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,30*this._dragX),this._model.addParameterValueById(this._idParamAngleY,30*this._dragY),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,10*this._dragX),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),null!=this._breath&&this._breath.updateParameters(this._model,t),null!=this._physics&&this._physics.evaluate(this._model,t),this._lipsync){const t=0;for(let e=0;e<this._lipSyncIds.getSize();++e)this._model.addParameterValueById(this._lipSyncIds.at(e),t,.8)}null!=this._pose&&this._pose.updateParameters(this._model,t),this._model.update()}startMotion(t,e,i,s){if(3==i)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&je.printMessage("[APP]can't start motion."),yi;const r=this._modelSetting.getMotionFileName(t,e),a=`${t}_${e}`;let n=this._motions.getValue(a),o=!1;return null==n?fetch(`${this._modelHomeDir}/${r}`).then(t=>t.arrayBuffer()).then(i=>{n=this.loadMotion(i,i.byteLength,null,s);let r=this._modelSetting.getMotionFadeInTimeValue(t,e);r>=0&&n.setFadeInTime(r),r=this._modelSetting.getMotionFadeOutTimeValue(t,e),r>=0&&n.setFadeOutTime(r),n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),o=!0}):n.setFinishedMotionHandler(s),this._debugMode&&je.printMessage(`[APP]start motion: [${t}_${e}`),this._motionManager.startMotionPriority(n,o,i)}startRandomMotion(t,e,i){if(0==this._modelSetting.getMotionCount(t))return yi;const s=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,s,e,i)}setExpression(t){const e=this._expressions.getValue(t);this._debugMode&&je.printMessage(`[APP]expression: [${t}]`),null!=e?this._expressionManager.startMotionPriority(e,!1,3):this._debugMode&&je.printMessage(`[APP]expression[${t}] is null`)}setRandomExpression(){if(0==this._expressions.getSize())return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let e=0;e<this._expressions.getSize();e++)if(e==t){const t=this._expressions._keyValues[e].first;return void this.setExpression(t)}}motionEventFired(t){l("{0} is fired on LAppModel!!",t.s)}hitTest(t,e,i){if(this._opacity<1)return!1;const s=this._modelSetting.getHitAreasCount();for(let r=0;r<s;r++)if(this._modelSetting.getHitAreaName(r)==t){const t=this._modelSetting.getHitAreaId(r);return this.isHit(t,e,i)}return!1}preLoadMotionGroup(t){for(let e=0;e<this._modelSetting.getMotionCount(t);e++){const i=this._modelSetting.getMotionFileName(t,e),s=`${t}_${e}`;this._debugMode&&je.printMessage(`[APP]load motion: ${i} => [${s}]`),fetch(`${this._modelHomeDir}/${i}`).then(t=>t.arrayBuffer()).then(i=>{const r=this.loadMotion(i,i.byteLength,s);let a=this._modelSetting.getMotionFadeInTimeValue(t,e);a>=0&&r.setFadeInTime(a),a=this._modelSetting.getMotionFadeOutTimeValue(t,e),a>=0&&r.setFadeOutTime(a),r.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),null!=this._motions.getValue(s)&&Mi.delete(this._motions.getValue(s)),this._motions.setValue(s,r),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=pi.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(ji))})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(null==this._model)return;const t=[0,0,Ui.width,Ui.height];this.getRenderer().setRenderState(Yi,t),this.getRenderer().drawModel()}draw(t){null!=this._model&&this._state==pi.CompleteSetup&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}}var wi=c.csmVector,Ti=C.CubismMatrix44;let Ei=null;class Fi{constructor(){this._finishedMotion=t=>{je.printMessage("Motion Finished:"),console.log(t)},this._viewMatrix=new Ti,this._models=new wi,this._sceneIndex=0,this.changeScene(this._sceneIndex)}static getInstance(){return null==Ei&&(Ei=new Fi),Ei}static releaseInstance(){null!=Ei&&(Ei=void 0),Ei=null}getModel(t){return t<this._models.getSize()?this._models.at(t):null}getClea(){return this.getModel(0)}releaseAllModel(){for(let t=0;t<this._models.getSize();t++)this._models.at(t).release(),this._models.set(t,null);this._models.clear()}onDrag(t,e){for(let i=0;i<this._models.getSize();i++){const s=this.getModel(i);s&&s.setDragging(t,e)}}onTap(t,e){for(let i=0;i<this._models.getSize();i++)if(this._models.at(i).hitTest("Head",t,e)){0;const t=new N;t.touchPart=A.Head,t.targetModel=this._models.at(i),Ui.dispatchEvent(t)}else if(this._models.at(i).hitTest("Oppai",t,e)){0;const t=new N;t.touchPart=A.Oppai,t.targetModel=this._models.at(i),Ui.dispatchEvent(t)}else if(this._models.at(i).hitTest("Body",t,e)){0,this._models.at(i).startRandomMotion("TapBody",2,this._finishedMotion);const t=new N;t.touchPart=A.Body,t.targetModel=this._models.at(i),Ui.dispatchEvent(t)}else if(this._models.at(i).hitTest("Face",t,e)){0;const t=new N;t.touchPart=A.Face,t.targetModel=this._models.at(i),Ui.dispatchEvent(t)}}onUpdate(){let t=new Ti;const{width:e,height:i}=Ui;t.scale(2,2*e/i),null!=this._viewMatrix&&t.multiplyByMatrix(this._viewMatrix);const s=t.clone(),r=this._models.getSize();for(let e=0;e<r;++e){const i=this.getModel(e);t=s.clone(),i.update(),i.draw(t)}}nextScene(){const t=(this._sceneIndex+1)%qe;this.changeScene(t)}changeScene(t){this._sceneIndex=t;const e="/static/l2dmodel/"+Ye[t]+"/";let i=Ye[t];i+=".model3.json",this.releaseAllModel(),this._models.pushBack(new Vi),this._models.at(0).loadAssets(e,i)}}var Li=L.CubismViewMatrix,Ri=C.CubismMatrix44;class Di{constructor(){this._programId=null,this._touchManager=new D,this._deviceToScreen=new Ri,this._viewMatrix=new Li}initialize(){const{offsetHeight:t,offsetWidth:e}=Ui,i=t/e,s=-i,r=i;this._viewMatrix.setScreenRect(-1,1,s,r);const a=Math.abs(-2);this._deviceToScreen.scaleRelative(a/e/2,-a/e/2),this._deviceToScreen.translateRelative(.5*-e,.5*-t),this._viewMatrix.setMaxScale(2),this._viewMatrix.setMinScale(.8),this._viewMatrix.setMaxScreenRect(-2,2,-2,2)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,ji.deleteProgram(this._programId),this._programId=null}render(){ji.useProgram(this._programId),ji.flush(),Fi.getInstance().onUpdate()}initializeSprite(){null==this._programId&&(this._programId=qi.getInstance().createShader())}onTouchesBegan(t,e){this._touchManager.touchesBegan(t,e)}onTouchesMoved(t,e){const i=this.transformViewX(this._touchManager.getX()),s=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(t,e),Fi.getInstance().onDrag(i,s)}onTouchesEnded(t,e,i){const s=Fi.getInstance();s.onDrag(0,0);{const t=this.transformViewX(this._touchManager.getX()),e=this.transformViewY(this._touchManager.getY());0,i&&s.onTap(t,e)}}transformViewX(t){const e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)}transformViewY(t){const e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}}var Ai=c.csmVector;class ki{constructor(){this._textures=new Ai}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())ji.deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,e,i){for(let s=this._textures.begin();s.notEqual(this._textures.end());s.preIncrement())if(s.ptr().fileName==t&&s.ptr().usePremultply==e)return s.ptr().img=new Image,s.ptr().img.onload=()=>i(s.ptr()),void(s.ptr().img.src=t);const s=new Image;s.onload=()=>{const r=ji.createTexture();ji.bindTexture(ji.TEXTURE_2D,r),ji.texParameteri(ji.TEXTURE_2D,ji.TEXTURE_MIN_FILTER,ji.LINEAR_MIPMAP_LINEAR),ji.texParameteri(ji.TEXTURE_2D,ji.TEXTURE_MAG_FILTER,ji.LINEAR),e&&ji.pixelStorei(ji.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),ji.texImage2D(ji.TEXTURE_2D,0,ji.RGBA,ji.RGBA,ji.UNSIGNED_BYTE,s),ji.generateMipmap(ji.TEXTURE_2D),ji.bindTexture(ji.TEXTURE_2D,null);const a=new Ni;null!=a&&(a.fileName=t,a.width=s.width,a.height=s.height,a.id=r,a.img=s,a.usePremultply=e,this._textures.pushBack(a)),i(a)},s.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._textures.set(e,null),this._textures.remove(e);break}}}class Ni{constructor(){this.id=null,this.width=0,this.height=0}}i.d(e,"canvas",(function(){return Ui})),i.d(e,"canvas_container",(function(){return zi})),i.d(e,"s_instance",(function(){return Xi})),i.d(e,"gl",(function(){return ji})),i.d(e,"frameBuffer",(function(){return Yi})),i.d(e,"CleaPlayer",(function(){return qi})),i.d(e,"CleaLive2DManager",(function(){return Fi})),i.d(e,"CleaTouchEventName",(function(){return"cleatouch"})),i.d(e,"CleaDragEndEventName",(function(){return"cleadragend"})),i.d(e,"TouchPart",(function(){return A})),i.d(e,"CleaTouchEvent",(function(){return N})),i.d(e,"CleaDragEndEvent",(function(){return O}));var Oi=v.CubismFramework;let Ui=null,zi=null,Xi=null,ji=null,Yi=null;class qi{constructor(){this._captured=!1,this._dragging=!1,this._preDragging=!1,this._paused=!0,this._dragOffsetX=0,this._dragOffsetY=0,this._startX=0,this._startY=0,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._lockPosBottom=-1,this._lockPosRight=-1,this._cubismOption=new F,this._view=new Di,this._textureManager=new ki}static getInstance(){return null==Xi&&(Xi=new qi),Xi}static releaseInstance(){null!=Xi&&Xi.release(),Xi=null}initialize(t,e){if(zi=t,null!=e)Ui=e;else if(t instanceof HTMLCanvasElement)Ui=t;else{for(let e of t.children)if(e instanceof HTMLCanvasElement){Ui=e;break}if(null==Ui){let t=document.getElementsByClassName("clea-canvas");for(let e of t)if(e instanceof HTMLCanvasElement){Ui=e;break}}null==Ui&&(Ui=document.createElement("canvas"),Ui.classList.add("clea-canvas"),t.appendChild(Ui))}if(Ui.width=500,Ui.height=500,function(){const t=zi.getBoundingClientRect(),e=window.innerWidth-t.width,i=window.innerHeight-t.height;zi.style.left=e+"px",zi.style.top=i+"px",Hi()}(),ji=Ui.getContext("webgl")||Ui.getContext("experimental-webgl"),!ji)return ji=null,!1;return Yi||(Yi=ji.getParameter(ji.FRAMEBUFFER_BINDING)),ji.enable(ji.BLEND),ji.blendFunc(ji.SRC_ALPHA,ji.ONE_MINUS_SRC_ALPHA),window.addEventListener("resize",Gi),"ontouchend"in Ui?(Ui.addEventListener("touchstart",ts),Ui.addEventListener("touchmove",es),Ui.addEventListener("touchend",is),Ui.addEventListener("touchcancel",ss)):(window.addEventListener("mousedown",Ki),window.addEventListener("mousemove",Zi),window.addEventListener("mouseup",Qi)),this._view.initialize(),this.initializeCubism(),!0}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,Fi.releaseInstance(),Oi.dispose()}pause(){ji.clearColor(0,0,0,0),this._paused=!0}isPaused(){return this._paused}run(){const t=()=>{null!=Xi&&(this._paused||(je.updateTime(),ji.clearColor(0,0,0,0),ji.enable(ji.DEPTH_TEST),ji.depthFunc(ji.LEQUAL),ji.clear(ji.COLOR_BUFFER_BIT|ji.DEPTH_BUFFER_BIT),ji.clearDepth(1),ji.enable(ji.BLEND),ji.blendFunc(ji.SRC_ALPHA,ji.ONE_MINUS_SRC_ALPHA),this._view.render(),requestAnimationFrame(t)))};this._paused=!1,t()}createShader(){const t=ji.createShader(ji.VERTEX_SHADER);if(null==t)return je.printMessage("failed to create vertexShader"),null;ji.shaderSource(t,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),ji.compileShader(t);const e=ji.createShader(ji.FRAGMENT_SHADER);if(null==e)return je.printMessage("failed to create fragmentShader"),null;ji.shaderSource(e,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),ji.compileShader(e);const i=ji.createProgram();return ji.attachShader(i,t),ji.attachShader(i,e),ji.deleteShader(t),ji.deleteShader(e),ji.linkProgram(i),ji.useProgram(i),i}getView(){return this._view}getTextureManager(){return this._textureManager}initializeCubism(){this._cubismOption.logFunction=je.printMessage,this._cubismOption.loggingLevel=He,Oi.startUp(this._cubismOption),Oi.initialize(),Fi.getInstance(),je.updateTime(),this._view.initializeSprite()}}function Hi(){const t=zi.getBoundingClientRect(),e=t.left/window.innerWidth,i=t.top/window.innerHeight;qi.getInstance()._lockPosRight=e<.25?-1:e>.6?window.innerWidth-t.left:-1,qi.getInstance()._lockPosBottom=i<.25?-1:i>.6?window.innerHeight-t.top:-1}function Gi(){const t=zi.getBoundingClientRect();let e=t.left,i=t.top;-1!=qi.getInstance()._lockPosRight&&(e=window.innerWidth-qi.getInstance()._lockPosRight),-1!=qi.getInstance()._lockPosBottom&&(i=window.innerHeight-qi.getInstance()._lockPosBottom),zi.style.left=e+"px",zi.style.top=i+"px"}function Wi(){if(!qi.getInstance()._captured)return;qi.getInstance()._preDragging=!0,qi.getInstance()._dragging=!0;let t=Fi.getInstance().getModel(0);if(null!=t){const e=()=>{(qi.getInstance()._dragging||qi.getInstance()._preDragging)&&t.startRandomMotion("Dragging",3,e)};e()}}function Ji(t,e){if(qi.getInstance()._preDragging)return function(t,e){qi.getInstance()._dragOffsetX=zi.offsetLeft-t,qi.getInstance()._dragOffsetY=zi.offsetTop-e}(t,e),void(qi.getInstance()._preDragging=!1);const i=t+qi.getInstance()._dragOffsetX,s=e+qi.getInstance()._dragOffsetY;zi.style.left=i+"px",zi.style.top=s+"px"}function $i(t,e){qi.getInstance()._dragging=!1,qi.getInstance()._preDragging=!1,qi.getInstance()._dragCancelHandle=null,Ui.dispatchEvent(new O),Hi()}function Ki(t){if(t.target!=Ui)return;if(!qi.getInstance()._view)return void je.printMessage("view notfound");qi.getInstance()._captured=!0,qi.getInstance()._dragCancelHandle=setTimeout(Wi,500);const e=Ui.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;qi.getInstance()._startX=t.clientX,qi.getInstance()._startY=t.clientY,qi.getInstance()._view.onTouchesBegan(i,s)}function Zi(t){if(!qi.getInstance()._captured)return;if(t.preventDefault(),!qi.getInstance()._view)return void je.printMessage("view notfound");if(qi.getInstance()._dragging)Ji(t.clientX,t.clientY);else if(null!=qi.getInstance()._dragCancelHandle){const e=t.clientX-qi.getInstance()._startX,i=t.clientY-qi.getInstance()._startY;e*e+i*i>64&&(clearTimeout(qi.getInstance()._dragCancelHandle),qi.getInstance()._dragCancelHandle=null)}const e=Ui.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;qi.getInstance()._view.onTouchesMoved(i,s)}function Qi(t){if(qi.getInstance()._captured=!1,!qi.getInstance()._view)return void je.printMessage("view notfound");const e=Ui.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;let r=!qi.getInstance()._dragging;qi.getInstance()._dragging?$i():null!=qi.getInstance()._dragCancelHandle&&(clearTimeout(qi.getInstance()._dragCancelHandle),qi.getInstance()._dragCancelHandle=null),t.target!=Ui&&(r=!1),qi.getInstance()._view.onTouchesEnded(i,s,r)}function ts(t){if(!qi.getInstance()._view)return void je.printMessage("view notfound");t.preventDefault(),qi.getInstance()._dragCancelHandle=setTimeout(Wi,500),qi.getInstance()._captured=!0;const e=t.target.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,s=t.changedTouches[0].clientY-e.top;qi.getInstance()._startX=t.changedTouches[0].clientX,qi.getInstance()._startY=t.changedTouches[0].clientY,qi.getInstance()._view.onTouchesBegan(i,s)}function es(t){if(!qi.getInstance()._captured)return;if(t.preventDefault(),!qi.getInstance()._view)return void je.printMessage("view notfound");if(qi.getInstance()._dragging)Ji(t.changedTouches[0].clientX,t.changedTouches[0].clientY);else if(null!=qi.getInstance()._dragCancelHandle){const e=t.changedTouches[0].clientX-qi.getInstance()._startX,i=t.changedTouches[0].clientY-qi.getInstance()._startY;e*e+i*i>64&&(clearTimeout(qi.getInstance()._dragCancelHandle),qi.getInstance()._dragCancelHandle=null)}const e=Ui.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,s=t.changedTouches[0].clientY-e.top;qi.getInstance()._view.onTouchesMoved(i,s)}function is(t){if(qi.getInstance()._captured=!1,!qi.getInstance()._view)return void je.printMessage("view notfound");const e=Ui.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,s=t.changedTouches[0].clientY-e.top,r=!qi.getInstance()._dragging;qi.getInstance()._dragging?$i():null!=qi.getInstance()._dragCancelHandle&&(clearTimeout(qi.getInstance()._dragCancelHandle),qi.getInstance()._dragCancelHandle=null),qi.getInstance()._view.onTouchesEnded(i,s,r)}function ss(t){if(qi.getInstance()._captured=!1,!qi.getInstance()._view)return void je.printMessage("view notfound");const e=Ui.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,s=t.changedTouches[0].clientY-e.top;qi.getInstance()._view.onTouchesEnded(i,s,!1)}}])}));