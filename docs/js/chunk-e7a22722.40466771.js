(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e7a22722"],{"10d1":function(t,e,n){"use strict";var a,r=n("da84"),i=n("e2cc"),s=n("f183"),c=n("6d61"),o=n("acac"),u=n("861d"),l=n("69f3").enforce,f=n("7f9a"),h=!r.ActiveXObject&&"ActiveXObject"in r,d=Object.isExtensible,p=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},v=t.exports=c("WeakMap",p,o);if(f&&h){a=o.getConstructor(p,"WeakMap",!0),s.REQUIRED=!0;var m=v.prototype,g=m["delete"],b=m.has,w=m.get,y=m.set;i(m,{delete:function(t){if(u(t)&&!d(t)){var e=l(this);return e.frozen||(e.frozen=new a),g.call(this,t)||e.frozen["delete"](t)}return g.call(this,t)},has:function(t){if(u(t)&&!d(t)){var e=l(this);return e.frozen||(e.frozen=new a),b.call(this,t)||e.frozen.has(t)}return b.call(this,t)},get:function(t){if(u(t)&&!d(t)){var e=l(this);return e.frozen||(e.frozen=new a),b.call(this,t)?w.call(this,t):e.frozen.get(t)}return w.call(this,t)},set:function(t,e){if(u(t)&&!d(t)){var n=l(this);n.frozen||(n.frozen=new a),b.call(this,t)?y.call(this,t,e):n.frozen.set(t,e)}else y.call(this,t,e);return this}})}},"462c":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("p",{staticClass:"display px-4 primary--text"},[t._v(t._s(t.$t("Standpic")))]),n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"290"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.isLoadingDb?n("v-card",[n("v-card-title",{staticClass:"text-h5"},[t._v("DBダウンロード中... "),n("v-progress-circular",{staticClass:"ml-3",attrs:{indeterminate:""}})],1)],1):n("v-card",[n("v-card-title",{staticClass:"text-h5"},[t._v("DBをダウンロードしますか?")]),n("v-card-text",[t._v("この処理には時間がかかることがあります")]),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){t.dialog=!1}}},[t._v("No")]),n("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){return t.loadAssetBundle()}}},[t._v("Yes")])],1)],1)],1)],1),n("v-row",{attrs:{"no-gutters":""}},[n("v-col",{attrs:{cols:"12",sm:"12",lg:"6"}},[n("v-select",{staticClass:"px-4",attrs:{label:t.$t("Character")+" ("+t.characters.length+")",dense:"",items:t.characters.map((function(t,e){return{text:t.m_ADVCharaID,value:e}}))},model:{value:t.characterID,callback:function(e){t.characterID=e},expression:"characterID"}})],1),n("v-col",{attrs:{cols:"12",sm:"6",lg:"3"}},[n("v-select",{staticClass:"px-4",attrs:{label:t.$t("Pose")+" ("+t.poses.length+")",dense:"",items:t.poses.map((function(t,e){return{text:e,value:e}}))},model:{value:t.poseID,callback:function(e){t.poseID=e},expression:"poseID"}})],1),n("v-col",{staticStyle:{position:"relative"},attrs:{cols:"12",sm:"6",lg:"3"}},[n("v-select",{staticClass:"px-4",attrs:{label:t.$t("Face")+" ("+t.faces.length+")",dense:"",items:t.faces.map((function(t,e){return{text:""+t.key[2],value:e}}))},model:{value:t.faceID,callback:function(e){t.faceID=e},expression:"faceID"}}),n("v-overlay",{attrs:{absolute:"",value:t.loading,opacity:"0"}},[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)],1)],1),n("v-list-item",{attrs:{target:"_blank",href:t.$const.sites.standpic.format(t.base)}},[n("v-list-item-title",{staticClass:"primary--text"},[t._v(t._s(t.base)+" - "+t._s(t.$t("Assets.Title")))]),n("v-list-item-action",{staticClass:"ma-0"},[n("v-icon",[t._v("mdi-open-in-new")])],1)],1),n("v-divider",{staticClass:"mb-4"}),n("div",{staticClass:"px-4 float-right"},[n("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale*=.8}}},[n("v-icon",[t._v("mdi-magnify-minus")])],1),n("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale=1}}},[n("v-icon",[t._v("mdi-magnify-close")])],1),n("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale/=.8}}},[n("v-icon",[t._v("mdi-magnify-plus")])],1),t.downloading?n("v-progress-circular",{staticClass:"ml-4 mr-2",attrs:{indeterminate:"",size:"20",width:"3"}}):n("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:t.downloadImg}},[n("v-icon",[t._v("mdi-download")])],1)],1),n("div",{staticStyle:{width:"100%",overflow:"hidden",position:"relative"},style:{height:1200*t.scale+"px"}},[n("div",{staticStyle:{position:"absolute",left:"50%",transform:"translateX(-50%)"}},[n("div",{key:t.id,style:{transform:"scale("+t.scale+") translateY("+50*(t.scale-1)/t.scale+"%)"}},[t._m(0)])])])],1)},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-inline-block"},[n("canvas",{staticClass:"standpic"})])}],i=(n("a4d3"),n("e01a"),n("80e0"),n("99af"),n("4de4"),n("d81d"),n("fb6a"),n("b0c0"),n("b64b"),n("d3b7"),n("4d63"),n("25f0"),n("3ca3"),n("466d"),n("5319"),n("1276"),n("2ca0"),n("10d1"),n("159b"),n("ddb0"),n("2b3d"),n("53ca")),s=n("262e"),c=(n("99de"),n("7e84")),o=(n("e260"),n("4ec9"),n("b380"));n("c975");function u(t){return-1!==Function.toString.call(t).indexOf("[native code]")}n("4ae1");function l(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function f(t,e,n){return f=l()?Reflect.construct:function(t,e,n){var a=[null];a.push.apply(a,e);var r=Function.bind.apply(t,a),i=new r;return n&&Object(o["a"])(i,n.prototype),i},f.apply(null,arguments)}function h(t){var e="function"===typeof Map?new Map:void 0;return h=function(t){if(null===t||!u(t))return t;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return f(t,arguments,Object(c["a"])(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object(o["a"])(n,t)},h(t)}n("96cf");var d=n("bc3a"),p=n.n(d);function v(t,e){v=function(t,e){return new c(t,void 0,e)};var n=h(RegExp),a=RegExp.prototype,r=new WeakMap;function c(t,e,a){var i=n.call(this,t,e);return r.set(i,a||r.get(t)),i}function o(t,e){var n=r.get(e);return Object.keys(n).reduce((function(e,a){return e[a]=t[n[a]],e}),Object.create(null))}return Object(s["a"])(c,n),c.prototype.exec=function(t){var e=a.exec.call(this,t);return e&&(e.groups=o(e,this)),e},c.prototype[Symbol.replace]=function(t,e){if("string"===typeof e){var n=r.get(this);return a[Symbol.replace].call(this,t,e.replace(/\$<([^>]+)>/g,(function(t,e){return"$"+n[e]})))}if("function"===typeof e){var s=this;return a[Symbol.replace].call(this,t,(function(){var t=[];return t.push.apply(t,arguments),"object"!==Object(i["a"])(t[t.length-1])&&t.push(o(t,s)),e.apply(this,t)}))}return a[Symbol.replace].call(this,t,e)},v.apply(this,arguments)}var m={name:"Standpic",props:["id"],data:function(){return{index:[],loading:0,poseID:0,faceID:0,scale:1,characterID:0,downloading:!1,isLoadingDb:!1,dialog:!1}},computed:{characters:function(){var t=this;return this.$db.ADVCharacterListArray.filter((function(e){return e.m_ResourceBaseName.toLowerCase().startsWith(t.id.toLowerCase())}))},character:function(){return this.characters[this.characterID]},poses:function(){return this.character.m_Datas},faces:function(){var t=this;return this.index.filter((function(e){return"face"==e.key[0]&&e.key[1]==t.poseID}))},pose:function(){return this.poses[this.poseID]},face:function(){return this.faces[this.faceID]},base:function(){return this.character.m_ResourceBaseName.toLowerCase()},base_row:function(){return this.character.m_ResourceBaseName},faceContainerSize:function(){return 270},src:function(){return{standpic:"https://bucket-"+this.standpicPath()+"-asset.kirafan.cn/adv/standpic/"+this.base.toLowerCase()+"/"+this.base.toLowerCase()+"_standpic_0/"+this.base_row+"_StandPic_0.png",face:"https://bucket-"+(this.face?this.face.path:"")+"-asset.kirafan.cn/adv/standpic/"+this.base+"/"+this.base+"_face_"+this.poseID+"_"+((this.face&&this.face.key[2]||"undefined").toLowerCase()||"undefined")+"/"+this.base_row+"_Face_"+this.poseID+"_"+(this.face&&this.face.key[2]||"undefined").replace(/^(.)/,(function(t,e){return e.toUpperCase()}))+".png"}},style:function(){return{width:this.faceContainerSize+"px",height:this.faceContainerSize+"px",position:"absolute",left:this.pose.m_FaceX-this.faceContainerSize/2+"px",top:this.pose.m_FaceY-this.faceContainerSize/2+"px"}}},methods:{load:function(){var t,e=this;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return this.loading+=1,t=this.standpicDB()[this.base],this.index=t.map((function(t){var n=t.img.split(e.base)[1].split("_").slice(1);return{key:n,path:t.path}})),this.poseID>=this.poses.length&&(this.poseID=0),this.faceID>=this.faces.length&&(this.faceID=0),n.next=7,regeneratorRuntime.awrap(this.showImg());case 7:this.loading=0;case 8:case"end":return n.stop()}}),null,this)},loadAssetBundle:function(){var t,e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:if(this.isLoadingDb=!0,!this.$s.loadAssetbundle){n.next=5;break}t=this.$db.assetBundle,n.next=8;break;case 5:return n.next=7,regeneratorRuntime.awrap(p.a.get("https://database.kirafan.cn/assetBundle.json",{responseType:"json"}));case 7:t=n.sent.data;case 8:e={},t.filter((function(t){return t.name.match(/^adv\/standpic\//)})).forEach((function(t){var n=t.name,a=t.path,r=n.match(v(/adv\/standpic\/([\0-\.0-\uFFFF]+)\/([\0-\x2D0-\uFFFF]+).muast/,{name:1,img:2})),i=r.groups.name,s=r.groups.img,c=a[a.length-1];e[i]||(e[i]=[]),s.match("standpic")&&(e[i].standpicPath=c),e[i].push({img:s,path:c})})),this.$db.standpicDB=e,this.load(),this.isLoadingDb=!1,this.dialog=!1;case 14:case"end":return n.stop()}}),null,this)},showImg:function(){var t,e,n,a,r=this;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:return this.loading=1,t=new Image,e=new Image,n=[this.imgOnload(t,this.src.standpic)],this.face&&this.face.key[2]?(n.push(this.imgOnload(e,this.src.face)),a=!0):a=!1,i.next=7,regeneratorRuntime.awrap(Promise.all(n));case 7:return i.next=9,regeneratorRuntime.awrap(this.$nextTick((function(){var n=document.querySelector(".standpic");n.width=t.width,n.height=t.height;var i=n.getContext("2d");i.drawImage(t,0,0),a&&i.drawImage(e,r.pose.m_FaceX-e.width/2,r.pose.m_FaceY-e.height/2),r.loading=0})));case 9:case"end":return i.stop()}}),null,this)},downloadImg:function(){var t,e;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return this.downloading=!0,t=document.querySelector(".standpic"),n.next=4,regeneratorRuntime.awrap(this.toBlob(t));case 4:e=n.sent,this.fileDownloadFromBlob(e,"".concat(this.base,"_face_").concat(this.poseID,"_").concat(this.face&&this.face.key[2])+".png"),this.downloading=!1;case 7:case"end":return n.stop()}}),null,this)},toBlob:function(t){return new Promise((function(e,n){try{t.toBlob(e)}catch(a){n(a)}}))},imgOnload:function(t,e){return new Promise((function(n,a){var r;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:return t.onload=function(){return n()},t.onerror=function(t){return a(t)},i.next=4,regeneratorRuntime.awrap(p.a.get(e,{responseType:"blob"}));case 4:r=i.sent.data,t.src=URL.createObjectURL(r);case 6:case"end":return i.stop()}}))}))},fileDownloadFromBlob:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"img.png",n=URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e,a.click(),URL.revokeObjectURL(n)},standpicDB:function(){return this.$db.standpicDB},standpicPath:function(){try{return this.standpicDB()[this.base].standpicPath||""}catch(t){return""}}},watch:{id:function(){this.characterID=0},base:function(){this.load()},faceID:function(){this.showImg()}},mounted:function(){this.standpicDB()?this.load():this.$s.loadAssetbundle?this.loadAssetBundle():this.dialog=!0}},g=m,b=n("2877"),w=n("6544"),y=n.n(w),x=n("8336"),D=n("b0af"),_=n("99d9"),C=n("62ad"),k=n("169a"),I=n("ce7e"),R=n("132d"),B=n("da13"),S=n("1800"),z=n("5d23"),L=n("a797"),O=n("490a"),j=n("0fd9"),F=n("b974"),V=n("2fa4"),$=Object(b["a"])(g,a,r,!1,null,null,null);e["default"]=$.exports;y()($,{VBtn:x["a"],VCard:D["a"],VCardActions:_["a"],VCardText:_["b"],VCardTitle:_["c"],VCol:C["a"],VDialog:k["a"],VDivider:I["a"],VIcon:R["a"],VListItem:B["a"],VListItemAction:S["a"],VListItemTitle:z["d"],VOverlay:L["a"],VProgressCircular:O["a"],VRow:j["a"],VSelect:F["a"],VSpacer:V["a"]})},"80e0":function(t,e,n){var a=n("746f");a("replace")},acac:function(t,e,n){"use strict";var a=n("e2cc"),r=n("f183").getWeakData,i=n("825a"),s=n("861d"),c=n("19aa"),o=n("2266"),u=n("b727"),l=n("5135"),f=n("69f3"),h=f.set,d=f.getterFor,p=u.find,v=u.findIndex,m=0,g=function(t){return t.frozen||(t.frozen=new b)},b=function(){this.entries=[]},w=function(t,e){return p(t.entries,(function(t){return t[0]===e}))};b.prototype={get:function(t){var e=w(this,t);if(e)return e[1]},has:function(t){return!!w(this,t)},set:function(t,e){var n=w(this,t);n?n[1]=e:this.entries.push([t,e])},delete:function(t){var e=v(this.entries,(function(e){return e[0]===t}));return~e&&this.entries.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,n,u){var f=t((function(t,a){c(t,f,e),h(t,{type:e,id:m++,frozen:void 0}),void 0!=a&&o(a,t[u],t,n)})),p=d(e),v=function(t,e,n){var a=p(t),s=r(i(e),!0);return!0===s?g(a).set(e,n):s[a.id]=n,t};return a(f.prototype,{delete:function(t){var e=p(this);if(!s(t))return!1;var n=r(t);return!0===n?g(e)["delete"](t):n&&l(n,e.id)&&delete n[e.id]},has:function(t){var e=p(this);if(!s(t))return!1;var n=r(t);return!0===n?g(e).has(t):n&&l(n,e.id)}}),a(f.prototype,n?{get:function(t){var e=p(this);if(s(t)){var n=r(t);return!0===n?g(e).get(t):n?n[e.id]:void 0}},set:function(t,e){return v(this,t,e)}}:{add:function(t){return v(this,t,!0)}}),f}}}}]);
//# sourceMappingURL=chunk-e7a22722.40466771.js.map