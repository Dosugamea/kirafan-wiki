(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c3a169a"],{1664:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.adv?a("div",[a("p",{staticClass:"display px-4 primary--text"},[e._v(e._s(e.adv.m_Title))]),-1!=e.adv.m_LibraryID?[a("p",{staticClass:"px-4 primary--text"},[e.adv.m_ScriptTextName?[a("span",[e._v(e._s(e.$t("Section").format(parseInt(e.adv.m_ScriptTextName.slice(-2)))))]),a("span",[e._v(" — ")])]:e._e(),a("span",[e._v(e._s(e.$name(e.$store.state.$db.ADVLibraryList[e.adv.m_LibraryID].m_ListName)))])],2),a("div",{staticClass:"px-4 mb-4"},[a("div",{staticClass:"float-right"},[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index+1]},on:{click:function(t){return e.$router.replace("/scenario/".concat(e.scenarios[e.index+1].m_AdvID))}}},[a("v-icon",[e._v("mdi-chevron-right")])],1)],1),a("div",[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index-1]},on:{click:function(t){return e.$router.replace("/scenario/".concat(e.scenarios[e.index-1].m_AdvID))}}},[a("v-icon",[e._v("mdi-chevron-left")])],1)],1)])]:e._e(),a("v-divider"),this.cue&&!e.voice_loaded?a("div",{staticClass:"py-4 text-center"},[a("v-row",[a("v-col",{staticClass:"text-end",attrs:{cols:"5"}},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1),a("v-col",{staticClass:"text-start",attrs:{cols:"7"}},[a("div",{staticClass:"pt-2"},[e._v(e._s(e.$t("Voice Loading")))])])],1)],1):e._e(),e.adv.m_ScriptTextName?e.loading?a("div",{staticClass:"py-4 text-center"},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):[e._l(e.text,(function(t){return a("div",{key:"scenario-text-".concat(t.m_id)},[a("Item",{attrs:{item:e.get_voice_injected_item(t),show_voice:function(){return e.voice_loaded}}})],1)})),a("v-divider"),a("Ad",{key:"scenario-ad-".concat(e.id)}),-1!=e.adv.m_LibraryID?[a("v-divider",{staticClass:"mb-4"}),a("div",{staticClass:"px-4"},[a("div",{staticClass:"float-right"},[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index+1]},on:{click:function(t){return e.$router.replace("/scenario/".concat(e.scenarios[e.index+1].m_AdvID))}}},[a("v-icon",[e._v("mdi-chevron-right")])],1)],1),a("div",[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index-1]},on:{click:function(t){return e.$router.replace("/scenario/".concat(e.scenarios[e.index-1].m_AdvID))}}},[a("v-icon",[e._v("mdi-chevron-left")])],1)],1)])]:e._e()]:a("div",{staticClass:"pa-4"},[a("KeyValue",{attrs:{k:e.$t("No Scenario")}})],1)],2):a("div",{staticClass:"pa-4"},[a("KeyValue",{attrs:{k:e.$t("No Scenario")}})],1)},n=[],i=a("3835"),c=a("1da1"),s=(a("96cf"),a("4de4"),a("d3b7"),a("498a"),a("ac1f"),a("5319"),a("a434"),a("b64b"),a("99af"),a("fb6a"),a("3ca3"),a("ddb0"),a("d81d"),a("2b3d"),a("9861"),a("2ca0"),a("b0c0"),a("bc3a")),o=a.n(s),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-list-item",[e.character?a("v-list-item-avatar",{staticClass:"mx-auto mr-2 mr-md-4",attrs:{size:e.$size(),tile:""},on:{click:function(t){return e.$router.push("/standpic/".concat(e.character.m_ResourceBaseName))}}},[0==e.character.m_Datas[0].m_FaceReferenceImageType&&-1!=e.character.m_Datas[0].m_FacePattern?a("v-img",{attrs:{src:e.$asset.standpic.format(e.base,"".concat(e.base,"_face_0_default"))+".png"}}):0==e.character.m_Datas[0].m_FaceReferenceImageType&&-1==e.character.m_Datas[0].m_FacePattern?a("div",{style:e.style("standpic_0")}):1==e.character.m_Datas[0].m_FaceReferenceImageType?a("div",{style:e.style("face_0_default")}):e._e()],1):a("v-list-item-avatar",{staticClass:"mx-auto mr-2 mr-md-4",attrs:{size:e.$size(),tile:""}}),e.show_voice()?a("div",{staticClass:"mr-3"},[e.voice_url?a("voice",{style:"width:".concat(e.$size(),"px;height:").concat(e.$size(),"px;"),attrs:{name:e.name,cue:e.text.replace("br","").replace(/s+/g,""),override_url:e.voice_url}}):a("Voice",{style:"visibility: hidden;width:".concat(e.$size(),"px;height:").concat(e.$size(),"px;")})],1):e._e(),a("v-list-item-content",{staticClass:"mr-auto ml-0 py-1",staticStyle:{"max-width":"384px"}},[a("v-list-item-subtitle",{staticClass:"primary--text",domProps:{innerHTML:e._s(e.name)}}),a("div",{style:{"line-height":1.5,"font-size":e.$vuetify.breakpoint.xsOnly?"70%":null},domProps:{innerHTML:e._s(e.text)}})],1)],1)},m=[],d=(a("1276"),{name:"Item",props:["item","show_voice"],data:function(){return{voice_url:void 0}},computed:{id:function(){return this.item.m_charaName.split("$")[1]||this.item.m_charaName},voice:function(){return this.$store.state.$db.VoiceList[this.item.m_VoiceID]},character:function(){return this.$store.state.$db.ADVCharacterList[this.id]},name:function(){return-1==this.item.m_charaName.indexOf("$")?this.character?this.character.m_DisplayName:this.item.m_charaName:this.item.m_charaName.split("$")[0]},position:function(){var e=this.character.m_Datas[0].m_FaceX,t=this.character.m_Datas[0].m_FaceY,a=this.$size()*this.scale/2;return"".concat(a-e,"px ").concat(a-t,"px")},scale:function(){return 200/this.$size()},base:function(){return this.character.m_ResourceBaseName.toLowerCase()},text:function(){return this.item.m_text.replace(/\n/g,"<br>").replace(/<color=(.*?)>(.*?)<\/color>/g,(function(e,t,a){return'<span style="color: '.concat(t,'">').concat(a,"</span>")}))}},methods:{style:function(e){return{"min-height":"".concat(this.$size()*this.scale,"px"),"min-width":"".concat(this.$size()*this.scale,"px"),transform:"scale(".concat(1/this.scale,")"),"background-image":"url(".concat(this.$asset.standpic.format(this.base,"".concat(this.base,"_").concat(e)),".png)"),"background-position":this.position}}},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.item.voice_url){t.next=4;break}return t.next=3,e.item.voice_url;case 3:e.voice_url=t.sent;case 4:case"end":return t.stop()}}),t)})))()}}),l=d,v=a("2877"),p=a("6544"),h=a.n(p),_=a("adda"),f=a("da13"),b=a("8270"),x=a("5d23"),g=Object(v["a"])(l,u,m,!1,null,null,null),w=g.exports;h()(g,{VImg:_["a"],VListItem:f["a"],VListItemAvatar:b["a"],VListItemContent:x["b"],VListItemSubtitle:x["c"]});var y=a("cb38"),$=a.n(y),k=a("5406"),C=window.require("fs"),I=window.require("buffer").Buffer,D={name:"Scenario",props:["id"],components:{Item:w},data:function(){return{loading:0,text:null,cue_list:{},voice_promise:void 0}},computed:{adv:function(){return this.$store.state.$db.ADVList[this.id]},cue:function(){return this.$s.loadScenarioVoice?this.adv.m_CueSheet:void 0},categories:function(){return{1:{name:"story",path:"Story"},2:{name:"event",path:"Event"},3:{name:"chara",path:"CharaEvent"},4:{name:"chara",path:"CrossEvent"},5:{name:"weapon",path:"WeaponEvent"},6:{name:"other",path:"Other"},7:{name:"writer",path:"Writer"}}},scenarios:function(){for(var e=this,t=-1==this.adv.m_LibraryID?[]:this.$store.state.$db.ADVListArray.filter((function(t){return t.m_LibraryID==e.adv.m_LibraryID})),a=0;a<t.length;a++)a>0&&t[a].m_ScriptTextName&&t[a].m_ScriptTextName==t[a-1].m_ScriptTextName&&(t[a-1].m_Title=t[a-1].m_Title.replace("（イントロ）","").replace("イントロ","").trim(),t.splice(a,1),a-=1);return t},index:function(){for(var e in this.scenarios)if(this.scenarios[e].m_AdvID==this.id)return parseInt(e)},voice_loaded:function(){return Boolean(Object.keys(this.cue_list).length)}},methods:{get_voice_injected_item:function(e){var t=this;return e.voice_url=Object(c["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.voice_promise;case 2:return a.abrupt("return",t.cue_list["".concat(e.m_voiceLabel,"_0.wav")]);case 3:case"end":return a.stop()}}),a)})))(),e},get_audiobuffer_then_write:function(e,t){return Object(c["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r="https://krr-proxy.herokuapp.com/cri/?name=",a.next=3,fetch("".concat(r).concat(e)).then((function(e){return e.arrayBuffer()})).then((function(e){C.writeFileSync(t,I(e))}));case 3:case"end":return a.stop()}}),a)})))()},get_event_seq:function(e){return("00"+String(parseInt(e.slice(-2))-1)).slice(-2)},get_acb_awb:function(e,t){var a=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=a.get_audiobuffer_then_write("".concat(e,".acb"),"".concat(e,".acb")),i=a.get_audiobuffer_then_write("".concat(e,".awb"),"".concat(t,".awb")),r.next=4,Promise.all([n,i]);case 4:case"end":return r.stop()}}),r)})))()},unpack_to_cue_list:function(e,t){var a=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=k["a"].cri_key,r.next=3,$.a.acbParse("".concat(e,".acb"),n);case 3:s=r.sent,s.map((function(e){var r=Object(i["a"])(e,2),n=r[0],s=r[1],o=function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.voice_promise;case 2:return e.next=4,s().catch((function(){}));case 4:return r=C.readFileSync("./".concat(t,"/").concat(n)),i=new Blob([r],{type:"audio/wav"}),e.abrupt("return",URL.createObjectURL(i));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();a.$set(a.cue_list,n,{url:o,promise:!0})}));case 5:case"end":return r.stop()}}),r)})))()},load:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.cue_list={},e.voice_promise=void 0,e.adv&&e.adv.m_ScriptTextName){t.next=4;break}return t.abrupt("return");case 4:e.loading+=1,a=e.loading,e.cue&&(r=e.cue,e.cue.startsWith("event")&&(r="event_000000000".concat(e.get_event_seq(r))),e.voice_promise=Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.get_acb_awb(e.cue,r);case 2:return t.next=4,e.unpack_to_cue_list(e.cue,r);case 4:case"end":return t.stop()}}),t)})))()),o.a.get(e.$asset.advscript.format(e.categories[e.adv.m_Category].name,e.categories[e.adv.m_Category].path,e.adv.m_ScriptTextName)+".json").then((function(t){a==e.loading&&(e.text=t.data,e.loading=0)}));case 8:case"end":return t.stop()}}),t)})))()}},watch:{id:function(){this.load()}},mounted:function(){this.load()}},L=D,R=(a("98d5"),a("8336")),V=a("62ad"),S=a("ce7e"),N=a("132d"),j=a("490a"),O=a("0fd9"),T=Object(v["a"])(L,r,n,!1,null,"92fabe94",null);t["default"]=T.exports;h()(T,{VBtn:R["a"],VCol:V["a"],VDivider:S["a"],VIcon:N["a"],VProgressCircular:j["a"],VRow:O["a"]})},"98d5":function(e,t,a){"use strict";a("ac82")},ac82:function(e,t,a){}}]);
//# sourceMappingURL=chunk-0c3a169a.fd963453.js.map