(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-854b32ce"],{"462c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("p",{staticClass:"display px-4 primary--text"},[t._v(t._s(t.$t("Standpic")))]),a("v-row",{attrs:{justify:"center"}},[a("v-dialog",{attrs:{"max-width":"290"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.isLoadingDb?a("v-card",[a("v-card-title",{staticClass:"text-h5"},[t._v("DBダウンロード中... "),a("v-progress-circular",{staticClass:"ml-3",attrs:{indeterminate:""}})],1)],1):a("v-card",[a("v-card-title",{staticClass:"text-h5"},[t._v("DBをダウンロードしますか?")]),a("v-card-text",[t._v("この処理には時間がかかることがあります")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){t.dialog=!1}}},[t._v("No")]),a("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){return t.loadAssetBundle()}}},[t._v("Yes")])],1)],1)],1)],1),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{cols:"12",sm:"12",lg:"6"}},[a("v-select",{staticClass:"px-4",attrs:{label:t.$t("Character")+" ("+t.characters.length+")",dense:"",items:t.characters.map((function(t,e){return{text:t.m_ADVCharaID,value:e}}))},model:{value:t.characterID,callback:function(e){t.characterID=e},expression:"characterID"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",lg:"3"}},[a("v-select",{staticClass:"px-4",attrs:{label:t.$t("Pose")+" ("+t.poses.length+")",dense:"",items:t.poses.map((function(t,e){return{text:e,value:e}}))},model:{value:t.poseID,callback:function(e){t.poseID=e},expression:"poseID"}})],1),a("v-col",{staticStyle:{position:"relative"},attrs:{cols:"12",sm:"6",lg:"3"}},[a("v-select",{staticClass:"px-4",attrs:{label:t.$t("Face")+" ("+t.faces.length+")",dense:"",items:t.faces.map((function(t,e){return{text:""+t.key[2],value:e}}))},model:{value:t.faceID,callback:function(e){t.faceID=e},expression:"faceID"}}),a("v-overlay",{attrs:{absolute:"",value:t.loading,opacity:"0"}},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)],1)],1),a("v-list-item",{attrs:{target:"_blank",href:t.$const.sites.standpic.format(t.base)}},[a("v-list-item-title",{staticClass:"primary--text"},[t._v(t._s(t.base)+" - "+t._s(t.$t("Assets.Title")))]),a("v-list-item-action",{staticClass:"ma-0"},[a("v-icon",[t._v("mdi-open-in-new")])],1)],1),a("v-divider",{staticClass:"mb-4"}),a("div",{staticClass:"px-4 float-right"},[a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale*=.8}}},[a("v-icon",[t._v("mdi-magnify-minus")])],1),a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale=1}}},[a("v-icon",[t._v("mdi-magnify-close")])],1),a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale/=.8}}},[a("v-icon",[t._v("mdi-magnify-plus")])],1),t.downloading?a("v-progress-circular",{staticClass:"ml-4 mr-2",attrs:{indeterminate:"",size:"20",width:"3"}}):a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:t.downloadImg}},[a("v-icon",[t._v("mdi-download")])],1)],1),a("div",{staticStyle:{width:"100%",overflow:"hidden",position:"relative"},style:{height:1200*t.scale+"px"}},[a("div",{staticStyle:{position:"absolute",left:"50%",transform:"translateX(-50%)"}},[a("div",{key:t.id,style:{transform:"scale("+t.scale+") translateY("+50*(t.scale-1)/t.scale+"%)"}},[t._m(0)])])])],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d-inline-block"},[a("canvas",{staticClass:"standpic"})])}],i=(a("a4d3"),a("e01a"),a("80e0"),a("99af"),a("4de4"),a("d81d"),a("fb6a"),a("b0c0"),a("b64b"),a("d3b7"),a("4d63"),a("25f0"),a("3ca3"),a("466d"),a("5319"),a("1276"),a("2ca0"),a("10d1"),a("159b"),a("ddb0"),a("2b3d"),a("53ca")),r=a("262e"),c=(a("99de"),a("7e84")),o=(a("e260"),a("4ec9"),a("b380"));a("c975");function l(t){return-1!==Function.toString.call(t).indexOf("[native code]")}a("4ae1");function u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function d(t,e,a){return d=u()?Reflect.construct:function(t,e,a){var n=[null];n.push.apply(n,e);var s=Function.bind.apply(t,n),i=new s;return a&&Object(o["a"])(i,a.prototype),i},d.apply(null,arguments)}function h(t){var e="function"===typeof Map?new Map:void 0;return h=function(t){if(null===t||!l(t))return t;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,a)}function a(){return d(t,arguments,Object(c["a"])(this).constructor)}return a.prototype=Object.create(t.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),Object(o["a"])(a,t)},h(t)}a("96cf");var p=a("bc3a"),f=a.n(p);function m(t,e){m=function(t,e){return new c(t,void 0,e)};var a=h(RegExp),n=RegExp.prototype,s=new WeakMap;function c(t,e,n){var i=a.call(this,t,e);return s.set(i,n||s.get(t)),i}function o(t,e){var a=s.get(e);return Object.keys(a).reduce((function(e,n){return e[n]=t[a[n]],e}),Object.create(null))}return Object(r["a"])(c,a),c.prototype.exec=function(t){var e=n.exec.call(this,t);return e&&(e.groups=o(e,this)),e},c.prototype[Symbol.replace]=function(t,e){if("string"===typeof e){var a=s.get(this);return n[Symbol.replace].call(this,t,e.replace(/\$<([^>]+)>/g,(function(t,e){return"$"+a[e]})))}if("function"===typeof e){var r=this;return n[Symbol.replace].call(this,t,(function(){var t=[];return t.push.apply(t,arguments),"object"!==Object(i["a"])(t[t.length-1])&&t.push(o(t,r)),e.apply(this,t)}))}return n[Symbol.replace].call(this,t,e)},m.apply(this,arguments)}var v={name:"Standpic",props:["id"],data:function(){return{index:[],loading:0,poseID:0,faceID:0,scale:1,characterID:0,downloading:!1,isLoadingDb:!1,dialog:!1}},computed:{characters:function(){var t=this;return this.$db.ADVCharacterListArray.filter((function(e){return e.m_ResourceBaseName.toLowerCase().startsWith(t.id.toLowerCase())}))},character:function(){return this.characters[this.characterID]},poses:function(){return this.character.m_Datas},faces:function(){var t=this;return this.index.filter((function(e){return"face"==e.key[0]&&e.key[1]==t.poseID}))},pose:function(){return this.poses[this.poseID]},face:function(){return this.faces[this.faceID]},base:function(){return this.character.m_ResourceBaseName.toLowerCase()},base_row:function(){return this.character.m_ResourceBaseName},faceContainerSize:function(){return 270},src:function(){return{standpic:"https://bucket-"+this.standpicPath()+"-asset.kirafan.cn/adv/standpic/"+this.base.toLowerCase()+"/"+this.base.toLowerCase()+"_standpic_0/"+this.base_row+"_StandPic_0.png",face:"https://bucket-"+(this.face?this.face.path:"")+"-asset.kirafan.cn/adv/standpic/"+this.base+"/"+this.base+"_face_"+this.poseID+"_"+((this.face&&this.face.key[2]||"undefined").toLowerCase()||"undefined")+"/"+this.base_row+"_Face_"+this.poseID+"_"+(this.face&&this.face.key[2]||"undefined").replace(/^(.)/,(function(t,e){return e.toUpperCase()}))+".png"}},style:function(){return{width:this.faceContainerSize+"px",height:this.faceContainerSize+"px",position:"absolute",left:this.pose.m_FaceX-this.faceContainerSize/2+"px",top:this.pose.m_FaceY-this.faceContainerSize/2+"px"}}},methods:{load:function(){var t,e=this;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:return this.loading+=1,t=this.standpicDB()[this.base],this.index=t.map((function(t){var a=t.img.split(e.base)[1].split("_").slice(1);return{key:a,path:t.path}})),this.poseID>=this.poses.length&&(this.poseID=0),this.faceID>=this.faces.length&&(this.faceID=0),a.next=7,regeneratorRuntime.awrap(this.showImg());case 7:this.loading=0;case 8:case"end":return a.stop()}}),null,this)},loadAssetBundle:function(){var t,e;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:if(this.isLoadingDb=!0,!this.$s.loadAssetbundle){a.next=5;break}t=this.$db.assetBundle,a.next=8;break;case 5:return a.next=7,regeneratorRuntime.awrap(f.a.get("https://database.kirafan.cn/assetBundle.json",{responseType:"json"}));case 7:t=a.sent.data;case 8:e={},t.filter((function(t){return t.name.match(/^adv\/standpic\//)})).forEach((function(t){var a=t.name,n=t.path,s=a.match(m(/adv\/standpic\/([\0-\.0-\uFFFF]+)\/([\0-\x2D0-\uFFFF]+).muast/,{name:1,img:2})),i=s.groups.name,r=s.groups.img,c=n[n.length-1];e[i]||(e[i]=[]),r.match("standpic")&&(e[i].standpicPath=c),e[i].push({img:r,path:c})})),this.$db.standpicDB=e,this.load(),this.isLoadingDb=!1,this.dialog=!1;case 14:case"end":return a.stop()}}),null,this)},showImg:function(){var t,e,a,n,s=this;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:return this.loading=1,t=new Image,e=new Image,a=[this.imgOnload(t,this.src.standpic)],this.face&&this.face.key[2]?(a.push(this.imgOnload(e,this.src.face)),n=!0):n=!1,i.next=7,regeneratorRuntime.awrap(Promise.all(a));case 7:return i.next=9,regeneratorRuntime.awrap(this.$nextTick((function(){var a=document.querySelector(".standpic");a.width=t.width,a.height=t.height;var i=a.getContext("2d");i.drawImage(t,0,0),n&&i.drawImage(e,s.pose.m_FaceX-e.width/2,s.pose.m_FaceY-e.height/2),s.loading=0})));case 9:case"end":return i.stop()}}),null,this)},downloadImg:function(){var t,e;return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:return this.downloading=!0,t=document.querySelector(".standpic"),a.next=4,regeneratorRuntime.awrap(this.toBlob(t));case 4:e=a.sent,this.fileDownloadFromBlob(e,"".concat(this.base,"_face_").concat(this.poseID,"_").concat(this.face&&this.face.key[2])+".png"),this.downloading=!1;case 7:case"end":return a.stop()}}),null,this)},toBlob:function(t){return new Promise((function(e,a){try{t.toBlob(e)}catch(n){a(n)}}))},imgOnload:function(t,e){return new Promise((function(a,n){var s;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:return t.onload=function(){return a()},t.onerror=function(t){return n(t)},i.next=4,regeneratorRuntime.awrap(f.a.get(e,{responseType:"blob"}));case 4:s=i.sent.data,t.src=URL.createObjectURL(s);case 6:case"end":return i.stop()}}))}))},fileDownloadFromBlob:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"img.png",a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=e,n.click(),URL.revokeObjectURL(a)},standpicDB:function(){return this.$db.standpicDB},standpicPath:function(){try{return this.standpicDB()[this.base].standpicPath||""}catch(t){return""}}},watch:{id:function(){this.characterID=0},base:function(){this.load()},faceID:function(){this.showImg()}},mounted:function(){this.standpicDB()?this.load():this.$s.loadAssetbundle?this.loadAssetBundle():this.dialog=!0}},g=v,b=a("2877"),w=a("6544"),y=a.n(w),x=a("8336"),D=a("b0af"),_=a("99d9"),C=a("62ad"),I=a("169a"),k=a("ce7e"),R=a("132d"),B=a("da13"),S=a("1800"),L=a("5d23"),V=a("a797"),F=a("490a"),O=a("0fd9"),$=a("b974"),j=a("2fa4"),A=Object(b["a"])(g,n,s,!1,null,null,null);e["default"]=A.exports;y()(A,{VBtn:x["a"],VCard:D["a"],VCardActions:_["a"],VCardText:_["b"],VCardTitle:_["c"],VCol:C["a"],VDialog:I["a"],VDivider:k["a"],VIcon:R["a"],VListItem:B["a"],VListItemAction:S["a"],VListItemTitle:L["d"],VOverlay:V["a"],VProgressCircular:F["a"],VRow:O["a"],VSelect:$["a"],VSpacer:j["a"]})},"80e0":function(t,e,a){var n=a("746f");n("replace")}}]);
//# sourceMappingURL=chunk-854b32ce.5f7bbb5d.js.map