(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-854b32ce"],{"462c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("p",{staticClass:"display px-4 mb-10 primary--text"},[t._v(t._s(t.$t("Standpic")))]),a("v-row",{attrs:{justify:"center"}},[a("v-dialog",{attrs:{"max-width":"290"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t.isLoadingDb?a("v-card",[a("v-card-title",{staticClass:"text-h5"},[t._v("DBダウンロード中... "),a("v-progress-circular",{staticClass:"ml-3",attrs:{indeterminate:""}})],1)],1):a("v-card",[a("v-card-title",{staticClass:"text-h5"},[t._v("DBをダウンロードしますか?")]),a("v-card-text",[t._v("この処理には時間がかかることがあります")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){t.dialog=!1}}},[t._v("No")]),a("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:function(e){return t.loadAssetBundle()}}},[t._v("Yes")])],1)],1)],1)],1),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{cols:"12",sm:"12",lg:"6"}},[a("v-select",{staticClass:"px-4",attrs:{label:t.$t("Character")+" (".concat(t.characters.length,")"),dense:"",items:t.characters.map((function(t,e){return{text:t.m_ADVCharaID,value:e}}))},model:{value:t.characterID,callback:function(e){t.characterID=e},expression:"characterID"}})],1),a("v-col",{attrs:{cols:"12",sm:"6",lg:"3"}},[a("v-select",{staticClass:"px-4",attrs:{label:t.$t("Pose")+" (".concat(t.poses.length,")"),dense:"",items:t.poses.map((function(t,e){return{text:e,value:e}}))},model:{value:t.poseID,callback:function(e){t.poseID=e},expression:"poseID"}})],1),a("v-col",{staticStyle:{position:"relative"},attrs:{cols:"12",sm:"6",lg:"3"}},[a("v-select",{staticClass:"px-4",attrs:{label:t.$t("Face")+" (".concat(t.faces.length,")"),dense:"",items:t.faces.map((function(t,e){return{text:"".concat(t.key[2]),value:e}}))},model:{value:t.faceID,callback:function(e){t.faceID=e},expression:"faceID"}}),a("v-overlay",{attrs:{absolute:"",value:t.loading,opacity:"0"}},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)],1)],1),a("v-list-item",{attrs:{target:"_blank",href:t.$const.sites.standpic.format(t.base)}},[a("v-list-item-title",{staticClass:"primary--text"},[t._v(t._s(t.base)+" - "+t._s(t.$t("Assets.Title")))]),a("v-list-item-action",{staticClass:"ma-0"},[a("v-icon",[t._v("mdi-open-in-new")])],1)],1),a("v-divider",{staticClass:"mb-4"}),a("div",{staticClass:"px-4 float-right"},[a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale*=.8}}},[a("v-icon",[t._v("mdi-magnify-minus")])],1),a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale=1}}},[a("v-icon",[t._v("mdi-magnify-close")])],1),a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:function(e){t.scale/=.8}}},[a("v-icon",[t._v("mdi-magnify-plus")])],1),t.downloading?a("v-progress-circular",{staticClass:"ml-4 mr-2",attrs:{indeterminate:"",size:"20",width:"3"}}):a("v-btn",{staticClass:"ml-2",attrs:{icon:""},on:{click:t.downloadImg}},[a("v-icon",[t._v("mdi-download")])],1)],1),a("div",{staticStyle:{width:"100%",overflow:"hidden",position:"relative"},style:{height:1200*t.scale+"px"}},[a("div",{staticStyle:{position:"absolute",left:"50%",transform:"translateX(-50%)"}},[a("div",{key:t.id,style:{transform:"scale(".concat(t.scale,") translateY(").concat(50*(t.scale-1)/t.scale,"%)")}},[t._m(0)])])])],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d-inline-block"},[a("canvas",{staticClass:"standpic"})])}],r=(a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("25f0"),a("d3b7"),a("3ca3"),a("10d1"),a("ddb0"),a("b64b"),a("80e0"),a("5319"),a("a4d3"),a("e01a"),a("fb6a"),a("53ca")),c=a("b380"),i=a("262e");function o(){o=function(t,e){return new a(t,void 0,e)};var t=RegExp.prototype,e=new WeakMap;function a(t,n,s){var r=new RegExp(t,n);return e.set(r,s||e.get(t)),Object(c["a"])(r,a.prototype)}function n(t,a){var n=e.get(a);return Object.keys(n).reduce((function(e,a){return e[a]=t[n[a]],e}),Object.create(null))}return Object(i["a"])(a,RegExp),a.prototype.exec=function(e){var a=t.exec.call(this,e);return a&&(a.groups=n(a,this)),a},a.prototype[Symbol.replace]=function(a,s){if("string"==typeof s){var c=e.get(this);return t[Symbol.replace].call(this,a,s.replace(/\$<([^>]+)>/g,(function(t,e){return"$"+c[e]})))}if("function"==typeof s){var i=this;return t[Symbol.replace].call(this,a,(function(){var t=arguments;return"object"!=Object(r["a"])(t[t.length-1])&&(t=[].slice.call(t)).push(n(t,i)),s.apply(this,t)}))}return t[Symbol.replace].call(this,a,s)},o.apply(this,arguments)}var l=a("1da1"),u=(a("96cf"),a("4de4"),a("2ca0"),a("d81d"),a("1276"),a("159b"),a("466d"),a("b0c0"),a("99af"),a("2b3d"),a("9861"),a("7db0"),a("bc3a")),d=a.n(u),p={name:"Standpic",props:["id"],data:function(){return{index:[],loading:0,poseID:0,faceID:0,scale:1,characterID:0,downloading:!1,isLoadingDb:!1,dialog:!1}},computed:{characters:function(){var t=this;return this.$store.state.$db.ADVCharacterListArray.filter((function(e){return e.m_ResourceBaseName.toLowerCase().startsWith(t.id.toLowerCase())}))},character:function(){return this.characters[this.characterID]},poses:function(){return this.character.m_Datas},faces:function(){var t=this;return this.index.filter((function(e){return"face"==e.key[0]&&e.key[1]==t.poseID}))},pose:function(){return this.poses[this.poseID]},face:function(){return this.faces[this.faceID]},base:function(){return this.character.m_ResourceBaseName.toLowerCase()},base_row:function(){return this.character.m_ResourceBaseName},faceContainerSize:function(){return 270},src:function(){return{standpic:"https://bucket-"+this.standpicPath()+"-asset.kirafan.cn/adv/standpic/"+this.base.toLowerCase()+"/"+this.base.toLowerCase()+"_standpic_"+this.poseID+"/"+this.base_row+"_StandPic_"+this.poseID+".png",face:"https://bucket-"+(this.face?this.face.path:"")+"-asset.kirafan.cn/adv/standpic/"+this.base+"/"+this.base+"_face_"+this.poseID+"_"+((this.face&&this.face.key[2]||"undefined").toLowerCase()||"undefined")+"/"+this.base_row+"_Face_"+this.poseID+"_"+(this.face&&this.face.key[2]||"undefined").replace(/^(.)/,(function(t,e){return e.toUpperCase()}))+".png"}},style:function(){return{width:this.faceContainerSize+"px",height:this.faceContainerSize+"px",position:"absolute",left:this.pose.m_FaceX-this.faceContainerSize/2+"px",top:this.pose.m_FaceY-this.faceContainerSize/2+"px"}}},methods:{load:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading+=1,a=t.standpicDB()[t.base],t.index=a.map((function(e){var a=e.img.split(t.base)[1].split("_").slice(1);return{key:a,path:e.path}})),t.poseID>=t.poses.length&&(t.poseID=0),t.faceID>=t.faces.length&&(t.faceID=0),e.next=7,t.showImg();case 7:t.loading=0;case 8:case"end":return e.stop()}}),e)})))()},loadAssetBundle:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.isLoadingDb=!0,a=t.$store.state.$db.assetBundle,n={},a.filter((function(t){return t.name.match(/^adv\/standpic\//)})).forEach((function(t){var e=t.name,a=t.path,s=e.match(o(/adv\/standpic\/([^/]+)\/([^/.]+).muast/,{name:1,img:2})),r=s.groups.name,c=s.groups.img,i=a[64];n[r]||(n[r]=[]),n[r].push({img:c,path:i})})),t.$store.state.$db.standpicDB=n,t.load(),t.isLoadingDb=!1,t.dialog=!1;case 8:case"end":return e.stop()}}),e)})))()},showImg:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,n,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=1,a=new Image,n=new Image,s=[t.imgOnload(a,t.src.standpic)],t.face&&t.face.key[2]?(s.push(t.imgOnload(n,t.src.face)),r=!0):r=!1,e.next=7,Promise.all(s);case 7:return e.next=9,t.$nextTick((function(){var e=document.querySelector(".standpic");e.width=a.width,e.height=a.height;var s=e.getContext("2d");s.drawImage(a,0,0),r&&s.drawImage(n,t.pose.m_FaceX-n.width/2,t.pose.m_FaceY-n.height/2),t.loading=0}));case 9:case"end":return e.stop()}}),e)})))()},downloadImg:function(){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function e(){var a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.downloading=!0,a=document.querySelector(".standpic"),e.next=4,t.toBlob(a);case 4:n=e.sent,t.fileDownloadFromBlob(n,"".concat(t.base,"_face_").concat(t.poseID,"_").concat(t.face&&t.face.key[2])+".png"),t.downloading=!1;case 7:case"end":return e.stop()}}),e)})))()},toBlob:function(t){return new Promise((function(e,a){try{t.toBlob(e)}catch(n){a(n)}}))},imgOnload:function(t,e){return new Promise(function(){var a=Object(l["a"])(regeneratorRuntime.mark((function a(n,s){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.onload=function(){return n()},t.onerror=function(t){return s(t)},a.next=4,d.a.get(e,{responseType:"blob"});case 4:r=a.sent.data,t.src=URL.createObjectURL(r);case 6:case"end":return a.stop()}}),a)})));return function(t,e){return a.apply(this,arguments)}}())},fileDownloadFromBlob:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"img.png",a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=e,n.click(),URL.revokeObjectURL(a)},standpicDB:function(){return this.$store.state.$db.standpicDB},standpicPath:function(){var t=this;try{return this.standpicDB()[this.base].find((function(e){return e.img===t.base+"_standpic_"+String(t.poseID)})).path||""}catch(e){return""}}},watch:{id:function(){this.characterID=0},base:function(){this.load()},poseID:function(){this.load()},faceID:function(){this.showImg()}},mounted:function(){this.standpicDB()?this.load():this.loadAssetBundle()}},f=p,h=a("2877"),m=a("6544"),v=a.n(m),g=a("8336"),b=a("b0af"),w=a("99d9"),D=a("62ad"),_=a("169a"),x=a("ce7e"),y=a("132d"),I=a("da13"),k=a("1800"),C=a("5d23"),R=a("a797"),B=a("490a"),L=a("0fd9"),S=a("b974"),V=a("2fa4"),$=Object(h["a"])(f,n,s,!1,null,null,null);e["default"]=$.exports;v()($,{VBtn:g["a"],VCard:b["a"],VCardActions:w["a"],VCardText:w["b"],VCardTitle:w["c"],VCol:D["a"],VDialog:_["a"],VDivider:x["a"],VIcon:y["a"],VListItem:I["a"],VListItemAction:k["a"],VListItemTitle:C["d"],VOverlay:R["a"],VProgressCircular:B["a"],VRow:L["a"],VSelect:S["a"],VSpacer:V["a"]})},"80e0":function(t,e,a){var n=a("746f");n("replace")}}]);
//# sourceMappingURL=chunk-854b32ce.7ff3c0f9.js.map