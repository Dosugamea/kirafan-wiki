(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-53ca060b"],{1664:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.adv?a("div",[a("p",{staticClass:"display px-4 primary--text"},[e._v(e._s(e.adv.m_Title))]),-1!=e.adv.m_LibraryID?[a("p",{staticClass:"px-4 primary--text"},[e.adv.m_ScriptTextName?[a("span",[e._v(e._s(e.$t("Section").format(parseInt(e.adv.m_ScriptTextName.slice(-2)))))]),a("span",[e._v(" — ")])]:e._e(),a("span",[e._v(e._s(e.$name(e.$store.state.$db.ADVLibraryList[e.adv.m_LibraryID].m_ListName)))])],2),a("div",{staticClass:"px-4 mb-4"},[a("div",{staticClass:"float-right"},[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index+1]},on:{click:function(t){return e.$router.replace("/scenario/"+e.scenarios[e.index+1].m_AdvID)}}},[a("v-icon",[e._v("mdi-chevron-right")])],1)],1),a("div",[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index-1]},on:{click:function(t){return e.$router.replace("/scenario/"+e.scenarios[e.index-1].m_AdvID)}}},[a("v-icon",[e._v("mdi-chevron-left")])],1)],1)])]:e._e(),a("v-divider"),this.cue&&!e.voice_loaded?a("div",{staticClass:"py-4 text-center"},[a("v-row",[a("v-col",{staticClass:"text-end",attrs:{cols:"5"}},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1),a("v-col",{staticClass:"text-start",attrs:{cols:"7"}},[a("div",{staticClass:"pt-2"},[e._v(e._s(e.$t("Voice Loading")))])])],1)],1):e._e(),e.adv.m_ScriptTextName?e.loading?a("div",{staticClass:"py-4 text-center"},[a("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):[e._l(e.text,(function(t){return a("div",{key:"scenario-text-"+t.m_id},[a("Item",{attrs:{item:e.get_voice_injected_item(t),show_voice:function(){return e.voice_loaded}}})],1)})),a("v-divider"),a("Ad",{key:"scenario-ad-"+e.id}),-1!=e.adv.m_LibraryID?[a("v-divider",{staticClass:"mb-4"}),a("div",{staticClass:"px-4"},[a("div",{staticClass:"float-right"},[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index+1]},on:{click:function(t){return e.$router.replace("/scenario/"+e.scenarios[e.index+1].m_AdvID)}}},[a("v-icon",[e._v("mdi-chevron-right")])],1)],1),a("div",[a("v-btn",{attrs:{icon:"",disabled:!e.scenarios[e.index-1]},on:{click:function(t){return e.$router.replace("/scenario/"+e.scenarios[e.index-1].m_AdvID)}}},[a("v-icon",[e._v("mdi-chevron-left")])],1)],1)])]:e._e()]:a("div",{staticClass:"pa-4"},[a("KeyValue",{attrs:{k:e.$t("No Scenario")}})],1)],2):a("div",{staticClass:"pa-4"},[a("KeyValue",{attrs:{k:e.$t("No Scenario")}})],1)},i=[],n=(a("99af"),a("4de4"),a("d81d"),a("fb6a"),a("a434"),a("b0c0"),a("b64b"),a("d3b7"),a("e25e"),a("3ca3"),a("5319"),a("2ca0"),a("498a"),a("ddb0"),a("2b3d"),a("3835")),s=(a("96cf"),a("bc3a")),c=a.n(s),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-list-item",[e.character?a("v-list-item-avatar",{staticClass:"mx-auto mr-2 mr-md-4",attrs:{size:e.$size(),tile:""},on:{click:function(t){return e.$router.push("/standpic/"+e.character.m_ResourceBaseName)}}},[0==e.character.m_Datas[0].m_FaceReferenceImageType&&-1!=e.character.m_Datas[0].m_FacePattern?a("v-img",{attrs:{src:e.$asset.standpic.format(e.base,e.base+"_face_0_default")+".png"}}):0==e.character.m_Datas[0].m_FaceReferenceImageType&&-1==e.character.m_Datas[0].m_FacePattern?a("div",{style:e.style("standpic_0")}):1==e.character.m_Datas[0].m_FaceReferenceImageType?a("div",{style:e.style("face_0_default")}):e._e()],1):a("v-list-item-avatar",{staticClass:"mx-auto mr-2 mr-md-4",attrs:{size:e.$size(),tile:""}}),e.show_voice()?a("div",{staticClass:"mr-3"},[e.voice_url?a("voice",{style:"width:"+e.$size()+"px;height:"+e.$size()+"px;",attrs:{name:e.name,cue:e.text.replace("br","").replace(/s+/g,""),override_url:e.voice_url}}):a("Voice",{style:"visibility: hidden;width:"+e.$size()+"px;height:"+e.$size()+"px;"})],1):e._e(),a("v-list-item-content",{staticClass:"mr-auto ml-0 py-1",staticStyle:{"max-width":"384px"}},[a("v-list-item-subtitle",{staticClass:"primary--text",domProps:{innerHTML:e._s(e.name)}}),a("div",{style:{"line-height":1.5,"font-size":e.$vuetify.breakpoint.xsOnly?"70%":null},domProps:{innerHTML:e._s(e.text)}})],1)],1)},u=[],m=(a("c975"),a("1276"),{name:"Item",props:["item","show_voice"],data:function(){return{voice_url:void 0}},computed:{id:function(){return this.item.m_charaName.split("$")[1]||this.item.m_charaName},voice:function(){return this.$store.state.$db.VoiceList[this.item.m_VoiceID]},character:function(){return this.$store.state.$db.ADVCharacterList[this.id]},name:function(){return-1==this.item.m_charaName.indexOf("$")?this.character?this.character.m_DisplayName:this.item.m_charaName:this.item.m_charaName.split("$")[0]},position:function(){var e=this.character.m_Datas[0].m_FaceX,t=this.character.m_Datas[0].m_FaceY,a=this.$size()*this.scale/2;return"".concat(a-e,"px ").concat(a-t,"px")},scale:function(){return 200/this.$size()},base:function(){return this.character.m_ResourceBaseName.toLowerCase()},text:function(){return this.item.m_text.replace(/\n/g,"<br>").replace(/<color=(.*?)>(.*?)<\/color>/g,(function(e,t,a){return'<span style="color: '.concat(t,'">').concat(a,"</span>")}))}},methods:{style:function(e){return{"min-height":"".concat(this.$size()*this.scale,"px"),"min-width":"".concat(this.$size()*this.scale,"px"),transform:"scale(".concat(1/this.scale,")"),"background-image":"url(".concat(this.$asset.standpic.format(this.base,"".concat(this.base,"_").concat(e)),".png)"),"background-position":this.position}}},mounted:function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.item.voice_url){e.next=4;break}return e.next=3,regeneratorRuntime.awrap(this.item.voice_url);case 3:this.voice_url=e.sent;case 4:case"end":return e.stop()}}),null,this)}}),d=m,l=a("2877"),h=a("6544"),v=a.n(h),p=a("adda"),_=a("da13"),f=a("8270"),b=a("5d23"),x=Object(l["a"])(d,o,u,!1,null,null,null),g=x.exports;v()(x,{VImg:p["a"],VListItem:_["a"],VListItemAvatar:f["a"],VListItemContent:b["b"],VListItemSubtitle:b["c"]});var w=a("cb38"),y=a.n(w),$=a("5406"),C=window.require("fs"),I=window.require("buffer").Buffer,D={name:"Scenario",props:["id"],components:{Item:g},data:function(){return{loading:0,text:null,cue_list:{},voice_promise:void 0}},computed:{adv:function(){return this.$store.state.$db.ADVList[this.id]},cue:function(){return this.$s.loadScenarioVoice?this.adv.m_CueSheet:void 0},categories:function(){return{1:{name:"story",path:"Story"},2:{name:"event",path:"Event"},3:{name:"chara",path:"CharaEvent"},4:{name:"chara",path:"CrossEvent"},5:{name:"weapon",path:"WeaponEvent"},6:{name:"other",path:"Other"},7:{name:"writer",path:"Writer"}}},scenarios:function(){for(var e=this,t=-1==this.adv.m_LibraryID?[]:this.$store.state.$db.ADVListArray.filter((function(t){return t.m_LibraryID==e.adv.m_LibraryID})),a=0;a<t.length;a++)a>0&&t[a].m_ScriptTextName&&t[a].m_ScriptTextName==t[a-1].m_ScriptTextName&&(t[a-1].m_Title=t[a-1].m_Title.replace("（イントロ）","").replace("イントロ","").trim(),t.splice(a,1),a-=1);return t},index:function(){for(var e in this.scenarios)if(this.scenarios[e].m_AdvID==this.id)return parseInt(e)},voice_loaded:function(){return Boolean(Object.keys(this.cue_list).length)}},methods:{get_voice_injected_item:function(e){var t=this;return e.voice_url=function(){return regeneratorRuntime.async((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,regeneratorRuntime.awrap(t.voice_promise);case 2:return a.abrupt("return",t.cue_list["".concat(e.m_voiceLabel,"_0.wav")]);case 3:case"end":return a.stop()}}))}(),e},get_audiobuffer_then_write:function(e,t){var a;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:return a="https://krr-proxy.herokuapp.com/cri/?name=",r.next=3,regeneratorRuntime.awrap(fetch("".concat(a).concat(e)).then((function(e){return e.arrayBuffer()})).then((function(e){C.writeFileSync(t,I(e))})));case 3:case"end":return r.stop()}}))},get_event_seq:function(e){return("00"+String(parseInt(e.slice(-2))-1)).slice(-2)},get_acb_awb:function(e,t){var a,r;return regeneratorRuntime.async((function(i){while(1)switch(i.prev=i.next){case 0:return a=this.get_audiobuffer_then_write("".concat(e,".acb"),"".concat(e,".acb")),r=this.get_audiobuffer_then_write("".concat(e,".awb"),"".concat(t,".awb")),i.next=4,regeneratorRuntime.awrap(Promise.all([a,r]));case 4:case"end":return i.stop()}}),null,this)},unpack_to_cue_list:function(e,t){var a,r,i=this;return regeneratorRuntime.async((function(s){while(1)switch(s.prev=s.next){case 0:return a=$["a"].cri_key,s.next=3,regeneratorRuntime.awrap(y.a.acbParse("".concat(e,".acb"),a));case 3:r=s.sent,r.map((function(e){var a=Object(n["a"])(e,2),r=a[0],s=a[1],c=function(){var e,a;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,regeneratorRuntime.awrap(i.voice_promise);case 2:return n.next=4,regeneratorRuntime.awrap(s().catch((function(){})));case 4:return e=C.readFileSync("./".concat(t,"/").concat(r)),a=new Blob([e],{type:"audio/wav"}),n.abrupt("return",URL.createObjectURL(a));case 7:case"end":return n.stop()}}))};i.$set(i.cue_list,r,{url:c,promise:!0})}));case 5:case"end":return s.stop()}}))},load:function(){var e,t,a=this;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:if(this.cue_list={},this.voice_promise=void 0,this.adv&&this.adv.m_ScriptTextName){r.next=4;break}return r.abrupt("return");case 4:this.loading+=1,e=this.loading,this.cue&&(t=this.cue,this.cue.startsWith("event")&&(t="event_000000000".concat(this.get_event_seq(t))),this.voice_promise=function(){return regeneratorRuntime.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(a.get_acb_awb(a.cue,t));case 2:return e.next=4,regeneratorRuntime.awrap(a.unpack_to_cue_list(a.cue,t));case 4:case"end":return e.stop()}}))}()),c.a.get(this.$asset.advscript.format(this.categories[this.adv.m_Category].name,this.categories[this.adv.m_Category].path,this.adv.m_ScriptTextName)+".json").then((function(t){e==a.loading&&(a.text=t.data,a.loading=0)}));case 8:case"end":return r.stop()}}),null,this)}},watch:{id:function(){this.load()}},mounted:function(){this.load()}},R=D,L=(a("98d5"),a("8336")),k=a("62ad"),V=a("ce7e"),S=a("132d"),N=a("490a"),T=a("0fd9"),z=Object(l["a"])(R,r,i,!1,null,"92fabe94",null);t["default"]=z.exports;v()(z,{VBtn:L["a"],VCol:k["a"],VDivider:V["a"],VIcon:S["a"],VProgressCircular:N["a"],VRow:T["a"]})},"52e3":function(e,t,a){},"98d5":function(e,t,a){"use strict";a("52e3")}}]);
//# sourceMappingURL=chunk-53ca060b.b1bd0237.js.map